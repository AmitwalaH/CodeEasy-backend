{
  "language": "csharp",
  "slug": "bank-account",
  "docs": {
    "instructions": "# Instructions\r\n\r\nYour task is to implement bank accounts supporting opening/closing, withdrawals, and deposits of money.\r\n\r\nAs bank accounts can be accessed in many different ways (internet, mobile phones, automatic charges), your bank software must allow accounts to be safely accessed from multiple threads/processes (terminology depends on your programming language) in parallel.\r\nFor example, there may be many deposits and withdrawals occurring in parallel; you need to ensure there are no [race conditions][wikipedia] between when you read the account balance and set the new balance.\r\n\r\nIt should be possible to close an account; operations against a closed account must fail.\r\n\r\n[wikipedia]: https://en.wikipedia.org/wiki/Race_condition#In_software\r\n",
    "instructions_append": "# Hints\r\n\r\nThis exercise requires you to handle data related to currency and money. A normal approach is to use the [Decimal](https://docs.microsoft.com/en-us/dotnet/api/system.decimal).\r\nNote though that you then only store the numeric value of a currency.\r\n",
    "hints": ""
  },
  "starter_code": {
    "BankAccount.cs": "public class BankAccount\r\n{\r\n    public void Open()\r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n\r\n    public void Close()\r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n\r\n    public decimal Balance\r\n    {\r\n        get\r\n        {\r\n            throw new NotImplementedException(\"You need to implement this property.\");\r\n        }\r\n    }\r\n\r\n    public void Deposit(decimal change)\r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n\r\n    public void Withdraw(decimal change)\r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n}\r\n"
  },
  "tests": {
    "BankAccountTests.cs": "public class BankAccountTests\r\n{\r\n    [Fact]\r\n    public void Newly_opened_account_has_zero_balance()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        Assert.Equal(0m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Single_deposit()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(100m);\r\n        Assert.Equal(100m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Multiple_deposits()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(100m);\r\n        account.Deposit(50m);\r\n        Assert.Equal(150m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Withdraw_once()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(100m);\r\n        account.Withdraw(75m);\r\n        Assert.Equal(25m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Withdraw_twice()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(100m);\r\n        account.Withdraw(80m);\r\n        account.Withdraw(20m);\r\n        Assert.Equal(0m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Can_do_multiple_operations_sequentially()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(100m);\r\n        account.Deposit(110m);\r\n        account.Withdraw(200m);\r\n        account.Deposit(60m);\r\n        account.Withdraw(50m);\r\n        Assert.Equal(20m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_check_balance_of_closed_account()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Close();\r\n        Assert.Throws<InvalidOperationException>(() => account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_deposit_into_closed_account()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Close();\r\n        Assert.Throws<InvalidOperationException>(() => account.Deposit(50m));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_deposit_into_unopened_account()\r\n    {\r\n        var account = new BankAccount();\r\n        Assert.Throws<InvalidOperationException>(() => account.Deposit(50m));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_withdraw_from_closed_account()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Close();\r\n        Assert.Throws<InvalidOperationException>(() => account.Withdraw(50m));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_close_an_account_that_was_not_opened()\r\n    {\r\n        var account = new BankAccount();\r\n        Assert.Throws<InvalidOperationException>(() => account.Close());\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_open_an_already_opened_account()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        Assert.Throws<InvalidOperationException>(() => account.Open());\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Reopened_account_does_not_retain_balance()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(50m);\r\n        account.Close();\r\n        account.Open();\r\n        Assert.Equal(0m, account.Balance);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_withdraw_more_than_deposited()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(25m);\r\n        Assert.Throws<InvalidOperationException>(() => account.Withdraw(50m));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_withdraw_negative()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        account.Deposit(100m);\r\n        Assert.Throws<InvalidOperationException>(() => account.Withdraw(-50m));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Cannot_deposit_negative()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        Assert.Throws<InvalidOperationException>(() => account.Deposit(-50m));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public async Task Can_handle_concurrent_transactions()\r\n    {\r\n        var account = new BankAccount();\r\n        account.Open();\r\n        for (int i = 0; i < 500; i++)\r\n        {\r\n            var tasks = new List<Task>();\r\n            tasks.Add(Task.Factory.StartNew(() =>\r\n            {\r\n                for (int j = 0; j < 100; j++)\r\n                {\r\n                    account.Deposit(1m);\r\n                    account.Withdraw(1m);\r\n                }\r\n            }, TestContext.Current.CancellationToken));\r\n            await Task.WhenAll(tasks.ToArray());\r\n        }\r\n        Assert.Equal(0m, account.Balance);\r\n    }\r\n}\r\n"
  }
}
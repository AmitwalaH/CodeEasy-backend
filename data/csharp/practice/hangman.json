{
  "language": "csharp",
  "slug": "hangman",
  "docs": {
    "instructions": "# Instructions\r\n\r\nImplement the logic of the hangman game using functional reactive programming.\r\n\r\n[Hangman][hangman] is a simple word guessing game.\r\n\r\n[Functional Reactive Programming][frp] is a way to write interactive programs.\r\nIt differs from the usual perspective in that instead of saying \"when the button is pressed increment the counter\", you write \"the value of the counter is the sum of the number of times the button is pressed.\"\r\n\r\nImplement the basic logic behind hangman using functional reactive programming.\r\nYou'll need to install an FRP library for this, this will be described in the language/track specific files of the exercise.\r\n\r\n[hangman]: https://en.wikipedia.org/wiki/Hangman_%28game%29\r\n[frp]: https://en.wikipedia.org/wiki/Functional_reactive_programming\r\n",
    "instructions_append": "# Hints\r\n\r\nThis exercise requires you to work with Reactive extension. For more information, see\r\n[this page](http://reactivex.io/intro.html) .\r\n\r\nIn reactive programming it's easier to communicate intentions in marble diagrams. Tests are augmented\r\nwith marble diagram information. Text format is parsable by\r\n[this tool](https://bitbucket.org/achary/rx-marbles/src/master/docs/syntax.md?fileviewer=file-view-default)\r\n.\r\n",
    "hints": ""
  },
  "starter_code": {
    "Hangman.cs": "using System.Collections.Immutable;\r\n\r\npublic class HangmanState\r\n{\r\n    public string MaskedWord { get; }\r\n    public ImmutableHashSet<char> GuessedChars { get; }\r\n    public int RemainingGuesses { get; }\r\n\r\n    public HangmanState(string maskedWord, ImmutableHashSet<char> guessedChars, int remainingGuesses)\r\n    {\r\n        MaskedWord = maskedWord;\r\n        GuessedChars = guessedChars;\r\n        RemainingGuesses = remainingGuesses;\r\n    }\r\n}\r\n\r\npublic class TooManyGuessesException : Exception\r\n{\r\n}\r\n\r\npublic class Hangman\r\n{\r\n    public IObservable<HangmanState> StateObservable { get => throw new NotImplementedException(\"You need to implement this method.\"); }\r\n    public IObserver<char> GuessObserver { get => throw new NotImplementedException(\"You need to implement this method.\"); }\r\n  \r\n    public Hangman(string word)\r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n}\r\n"
  },
  "tests": {
    "HangmanTests.cs": "using Microsoft.Reactive.Testing;\r\nusing System.Collections.Immutable;\r\nusing System.Reactive.Concurrency;\r\n\r\npublic class HangmanTests : ReactiveTest\r\n{\r\n    [Fact]\r\n    public void Initial_state_masks_the_word()\r\n    {\r\n        var hangman = new Hangman(\"foo\");\r\n        var actual = \"\";\r\n\r\n        // +a->\r\n        hangman.StateObservable.Subscribe(\r\n            x => actual = x.MaskedWord,\r\n            ex => throw new Exception(\"Should not finish with too many tries\"),\r\n            () => throw new Exception(\"Should not win yet\"));\r\n        Assert.Equal(\"___\", actual);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Initial_state_has_9_remaining_guesses()\r\n    {\r\n        var hangman = new Hangman(\"foo\");\r\n        var actual = 9;\r\n\r\n        // +a->\r\n        hangman.StateObservable.Subscribe(x => actual = x.RemainingGuesses);\r\n\r\n        Assert.Equal(9, actual);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Initial_state_has_no_guessed_chars()\r\n    {\r\n        var hangman = new Hangman(\"foo\");\r\n        var actual = new HashSet<char> {'x'}.ToImmutableHashSet();\r\n\r\n        // +a->\r\n        hangman.StateObservable.Subscribe(x => actual = x.GuessedChars);\r\n\r\n        Assert.Equal(new HashSet<char>().ToImmutableHashSet(), actual);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Guess_changes_state()\r\n    {\r\n        var hangman = new Hangman(\"foo\");\r\n        HangmanState? actual = null;\r\n        hangman.StateObservable.Subscribe(x => actual = x);\r\n        \r\n        Assert.NotNull(actual);\r\n        var initial = actual;\r\n\r\n        // +--x->\r\n        // +a-b->\r\n        hangman.GuessObserver.OnNext('x');\r\n\r\n        Assert.NotEqual(initial, actual);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Wrong_guess_decrements_remaining_guesses()\r\n    {\r\n        var hangman = new Hangman(\"foo\");\r\n        HangmanState? actual = null;\r\n        hangman.StateObservable.Subscribe(x => actual = x);\r\n        \r\n        Assert.NotNull(actual);\r\n        var initial = actual;\r\n\r\n        // +--x->\r\n        // +a-b->\r\n        hangman.GuessObserver.OnNext('x');\r\n\r\n        Assert.Equal(initial.RemainingGuesses - 1, actual.RemainingGuesses);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void After_10_incorrect_guesses_the_game_is_over()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        IObservable<HangmanState> Create()\r\n        {\r\n            var hangman = new Hangman(\"foo\");\r\n            for (var i = 1; i <= 10; i++)\r\n            {\r\n                scheduler.Schedule(TimeSpan.FromTicks(i * 100), () => hangman.GuessObserver.OnNext('x'));\r\n            }\r\n\r\n            return hangman.StateObservable;\r\n        }\r\n\r\n        var expected = new[]\r\n        {\r\n            OnNext<HangmanState>(100, hangmanState => hangmanState.RemainingGuesses == 9),\r\n            OnNext<HangmanState>(200, hangmanState => hangmanState.RemainingGuesses == 8),\r\n            OnNext<HangmanState>(300, hangmanState => hangmanState.RemainingGuesses == 7),\r\n            OnNext<HangmanState>(400, hangmanState => hangmanState.RemainingGuesses == 6),\r\n            OnNext<HangmanState>(500, hangmanState => hangmanState.RemainingGuesses == 5),\r\n            OnNext<HangmanState>(600, hangmanState => hangmanState.RemainingGuesses == 4),\r\n            OnNext<HangmanState>(700, hangmanState => hangmanState.RemainingGuesses == 3),\r\n            OnNext<HangmanState>(800, hangmanState => hangmanState.RemainingGuesses == 2),\r\n            OnNext<HangmanState>(900, hangmanState => hangmanState.RemainingGuesses == 1),\r\n            OnNext<HangmanState>(1000, hangmanState => hangmanState.RemainingGuesses == 0),\r\n            OnError<HangmanState>(1100, ex => ex is TooManyGuessesException)\r\n        };\r\n\r\n        // +--x-x-x-x-x-x-x-x-x-x->\r\n        // +a-b-c-d-e-f-g-h-i-j-#\r\n        ITestableObserver<HangmanState> testableObserver = scheduler.Start(Create, 100, 100, 3000);\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, testableObserver.Messages);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Correctly_guessing_a_letter_unmasks_it()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        IObservable<HangmanState> Create()\r\n        {\r\n            var hangman = new Hangman(\"foobar\");\r\n            scheduler.Schedule(TimeSpan.FromTicks(100), () => hangman.GuessObserver.OnNext('b'));\r\n            scheduler.Schedule(TimeSpan.FromTicks(200), () => hangman.GuessObserver.OnNext('o'));\r\n            return hangman.StateObservable;\r\n        }\r\n\r\n        var expected = new[]\r\n        {\r\n            OnNext<HangmanState>(100, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"______\"),\r\n            OnNext<HangmanState>(200, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"___b__\"),\r\n            OnNext<HangmanState>(300, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"_oob__\")\r\n        };\r\n\r\n        // +--b-o->\r\n        // +a-b-c->\r\n        ITestableObserver<HangmanState> testableObserver = scheduler.Start(Create, 100, 100, 3000);\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, testableObserver.Messages);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Guessing_a_correct_letter_twice_counts_as_a_failure()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        IObservable<HangmanState> Create()\r\n        {\r\n            var hangman = new Hangman(\"foobar\");\r\n            scheduler.Schedule(TimeSpan.FromTicks(100), () => hangman.GuessObserver.OnNext('b'));\r\n            scheduler.Schedule(TimeSpan.FromTicks(200), () => hangman.GuessObserver.OnNext('b'));\r\n            return hangman.StateObservable;\r\n        }\r\n\r\n        var expected = new[]\r\n        {\r\n            OnNext<HangmanState>(100, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"______\"),\r\n            OnNext<HangmanState>(200, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"___b__\"),\r\n            OnNext<HangmanState>(300, hangmanState => hangmanState.RemainingGuesses == 8 && hangmanState.MaskedWord == \"___b__\")\r\n        };\r\n\r\n        // +--b-b->\r\n        // +a-b-c->\r\n        ITestableObserver<HangmanState> testableObserver = scheduler.Start(Create, 100, 100, 3000);\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, testableObserver.Messages);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Getting_all_the_letters_right_makes_for_a_win()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        IObservable<HangmanState> Create()\r\n        {\r\n            var hangman = new Hangman(\"hello\");\r\n            scheduler.Schedule(TimeSpan.FromTicks(100), () => hangman.GuessObserver.OnNext('b'));\r\n            scheduler.Schedule(TimeSpan.FromTicks(200), () => hangman.GuessObserver.OnNext('e'));\r\n            scheduler.Schedule(TimeSpan.FromTicks(300), () => hangman.GuessObserver.OnNext('l'));\r\n            scheduler.Schedule(TimeSpan.FromTicks(400), () => hangman.GuessObserver.OnNext('o'));\r\n            scheduler.Schedule(TimeSpan.FromTicks(500), () => hangman.GuessObserver.OnNext('h'));\r\n            return hangman.StateObservable;\r\n        }\r\n\r\n        var expected = new[]\r\n        {\r\n            OnNext<HangmanState>(100, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"_____\"),\r\n            OnNext<HangmanState>(200, hangmanState => hangmanState.RemainingGuesses == 8 && hangmanState.MaskedWord == \"_____\"),\r\n            OnNext<HangmanState>(300, hangmanState => hangmanState.RemainingGuesses == 8 && hangmanState.MaskedWord == \"_e___\"),\r\n            OnNext<HangmanState>(400, hangmanState => hangmanState.RemainingGuesses == 8 && hangmanState.MaskedWord == \"_ell_\"),\r\n            OnNext<HangmanState>(500, hangmanState => hangmanState.RemainingGuesses == 8 && hangmanState.MaskedWord == \"_ello\"),\r\n            OnCompleted<HangmanState>(600)\r\n        };\r\n\r\n        // +--b-e-l-o-h->\r\n        // +a-b-c-d-e-|\r\n        ITestableObserver<HangmanState> testableObserver = scheduler.Start(Create, 100, 100, 3000);\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, testableObserver.Messages);\r\n    }\r\n\r\n    // Advanced mode on>\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Second_player_sees_the_same_game_already_started()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        var player2 = scheduler.CreateObserver<HangmanState>();\r\n        var hangman = new Hangman(\"hello\");\r\n\r\n        var player1 = hangman.StateObservable;\r\n        Ready(player1);\r\n\r\n        scheduler.Schedule(TimeSpan.FromTicks(100), () => hangman.GuessObserver.OnNext('e'));\r\n        scheduler.Schedule(TimeSpan.FromTicks(200), () => hangman.GuessObserver.OnNext('l'));\r\n        scheduler.Schedule(TimeSpan.FromTicks(150), () => hangman.StateObservable.Subscribe(player2));\r\n\r\n        var expected = new[]\r\n        {\r\n            OnNext<HangmanState>(150, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"_e___\"),\r\n            OnNext<HangmanState>(200, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"_ell_\")\r\n        };\r\n\r\n        // +--e--l->\r\n        // +a-b--c->\r\n        // ...+b-c->\r\n        scheduler.Start();\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, player2.Messages);\r\n    }\r\n\r\n    private IDisposable Ready(IObservable<HangmanState> player)\r\n    {\r\n        return player.Subscribe(x => { });\r\n    }\r\n\r\n    // Expert mode on>\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Multiple_players_see_the_same_game_already_started()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        var player2 = scheduler.CreateObserver<HangmanState>();\r\n        var player3 = scheduler.CreateObserver<HangmanState>();\r\n        var hangman = new Hangman(\"hello\");\r\n\r\n        var player1 = hangman.StateObservable;\r\n        Ready(player1);\r\n\r\n        scheduler.Schedule(TimeSpan.FromTicks(100), () => hangman.GuessObserver.OnNext('e'));\r\n        scheduler.Schedule(TimeSpan.FromTicks(200), () => hangman.GuessObserver.OnNext('l'));\r\n        scheduler.Schedule(TimeSpan.FromTicks(150), () =>\r\n            {\r\n                hangman.StateObservable.Subscribe(player2);\r\n                hangman.StateObservable.Subscribe(player3);\r\n            });\r\n\r\n        var expected = new[]\r\n        {\r\n            OnNext<HangmanState>(150, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"_e___\"),\r\n            OnNext<HangmanState>(200, hangmanState => hangmanState.RemainingGuesses == 9 && hangmanState.MaskedWord == \"_ell_\"),\r\n        };\r\n\r\n        // +--e--l->\r\n        // +a-b--c->\r\n        // ...+b-c->\r\n        // ...+b-c->\r\n        scheduler.Start();\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, player2.Messages);\r\n        ReactiveAssert.AreElementsEqual(expected, player3.Messages);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Player_joins_after_other_players_quit()\r\n    {\r\n        var scheduler = new TestScheduler();\r\n        var player2 = scheduler.CreateObserver<HangmanState>();\r\n        var hangman = new Hangman(\"a\");\r\n\r\n        var player1 = hangman.StateObservable;\r\n        var subscription = Ready(player1);\r\n\r\n        scheduler.Schedule(TimeSpan.FromTicks(100), () => hangman.GuessObserver.OnNext('a'));\r\n        scheduler.Schedule(TimeSpan.FromTicks(300), () =>\r\n            {\r\n                hangman.StateObservable.Subscribe(player2);\r\n            });\r\n        scheduler.Schedule(TimeSpan.FromTicks(200), () => subscription.Dispose());\r\n\r\n        var expected = new[]\r\n        {\r\n            OnCompleted<HangmanState>(300)\r\n        };\r\n\r\n        // +--a-|\r\n        // +a-|\r\n        // .....+|\r\n        scheduler.Start();\r\n\r\n        ReactiveAssert.AreElementsEqual(expected, player2.Messages);\r\n    }\r\n}\r\n"
  }
}
{
  "language": "csharp",
  "slug": "diffie-hellman",
  "docs": {
    "instructions": "# Instructions\r\n\r\nDiffie-Hellman key exchange.\r\n\r\nAlice and Bob use Diffie-Hellman key exchange to share secrets.\r\nThey start with prime numbers, pick private keys, generate and share public keys, and then generate a shared secret key.\r\n\r\n## Step 0\r\n\r\nThe test program supplies prime numbers p and g.\r\n\r\n## Step 1\r\n\r\nAlice picks a private key, a, greater than 1 and less than p.\r\nBob does the same to pick a private key b.\r\n\r\n## Step 2\r\n\r\nAlice calculates a public key A.\r\n\r\n    A = gᵃ mod p\r\n\r\nUsing the same p and g, Bob similarly calculates a public key B from his private key b.\r\n\r\n## Step 3\r\n\r\nAlice and Bob exchange public keys.\r\nAlice calculates secret key s.\r\n\r\n    s = Bᵃ mod p\r\n\r\nBob calculates\r\n\r\n    s = Aᵇ mod p\r\n\r\nThe calculations produce the same result!\r\nAlice and Bob now share secret s.\r\n",
    "instructions_append": "# Hints\r\n\r\nThis exercise requires you to perform calculations on large numbers. To correctly represent large numbers, the\r\n[BigInteger](https://docs.microsoft.com/en-us/dotnet/api/system.numerics.biginteger\r\n",
    "hints": ""
  },
  "starter_code": {
    "DiffieHellman.cs": "using System.Numerics;\r\n\r\npublic static class DiffieHellman\r\n{\r\n    public static BigInteger PrivateKey(BigInteger primeP) \r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n\r\n    public static BigInteger PublicKey(BigInteger primeP, BigInteger primeG, BigInteger privateKey) \r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n\r\n    public static BigInteger Secret(BigInteger primeP, BigInteger publicKey, BigInteger privateKey) \r\n    {\r\n        throw new NotImplementedException(\"You need to implement this method.\");\r\n    }\r\n}"
  },
  "tests": {
    "DiffieHellmanTests.cs": "using System.Numerics;\r\n\r\npublic class DiffieHellmanTests\r\n{\r\n    [Fact]\r\n    public void Private_key_is_greater_than_1_and_less_than_p()\r\n    {\r\n        var p = new BigInteger(7919);\r\n        var privateKeys = Enumerable.Range(0, 1000).Select(_ => DiffieHellman.PrivateKey(p));\r\n        foreach (var privateKey in privateKeys)\r\n        {\r\n            Assert.InRange(privateKey, new BigInteger(1), p);\r\n        }\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Private_key_is_random()\r\n    {\r\n        var p = new BigInteger(7919);\r\n        var privateKeys = Enumerable.Range(0, 1000).Select(_ => DiffieHellman.PrivateKey(p)).ToArray();\r\n        Assert.InRange(privateKeys.Distinct().Count(), privateKeys.Length - 100, privateKeys.Length);\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Can_calculate_public_key_using_private_key()\r\n    {\r\n        var p = new BigInteger(23);\r\n        var g = new BigInteger(5);\r\n        var privateKey = new BigInteger(6);\r\n        Assert.Equal(new BigInteger(8), DiffieHellman.PublicKey(p, g, privateKey));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Can_calculate_public_key_when_given_a_different_private_key()\r\n    {\r\n        var p = new BigInteger(23);\r\n        var g = new BigInteger(5);\r\n        var privateKey = new BigInteger(15);\r\n        Assert.Equal(new BigInteger(19), DiffieHellman.PublicKey(p, g, privateKey));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Can_calculate_secret_using_other_party_s_public_key()\r\n    {\r\n        var p = new BigInteger(23);\r\n        var theirPublicKey = new BigInteger(19);\r\n        var myPrivateKey = new BigInteger(6);\r\n        Assert.Equal(new BigInteger(2), DiffieHellman.Secret(p, theirPublicKey, myPrivateKey));\r\n    }\r\n\r\n    [Fact(Skip = \"Remove this Skip property to run this test\")]\r\n    public void Key_exchange()\r\n    {\r\n        var p = new BigInteger(23);\r\n        var g = new BigInteger(5);\r\n        var alicePrivateKey = DiffieHellman.PrivateKey(p);\r\n        var bobPrivateKey = DiffieHellman.PrivateKey(p);\r\n        var alicePublicKey = DiffieHellman.PublicKey(p, g, alicePrivateKey);\r\n        var bobPublicKey = DiffieHellman.PublicKey(p, g, bobPrivateKey);\r\n        var secretA = DiffieHellman.Secret(p, bobPublicKey, alicePrivateKey);\r\n        var secretB = DiffieHellman.Secret(p, alicePublicKey, bobPrivateKey);\r\n        Assert.Equal(secretA, secretB);\r\n    }\r\n}\r\n"
  }
}
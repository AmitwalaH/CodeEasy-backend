{
  "language": "csharp",
  "slug": "resource-cleanup",
  "title": "Resource Cleanup",
  "docs": {
    "about": "# About\r\n\r\nThe [`IDisposable`][idisposable] interface is central to resource cleanup and has two significant roles in C#:\r\n\r\n- It indicates to users of the implementing class that they are responsible for letting the class know (by calling the [`Dispose()`][dispose] method) that it is no longer required so that it can release any unmanaged resources or reset its internal state as appropriate. This contrasts with the normal approach to cleaning up of allowing the [garbage collector][garbage-collector] to clean everything up (principally, release memory).\r\n- In conjunction with the compiler and runtime the `IDisposable` interface supports the [`using` statement][using-statement] discussed in the `resource-lifetime` exercise.\r\n\r\nIt is possible but unlikely that `Dispose()` will be called through the interface in some sort of generic cleanup routine.\r\n\r\n`IDisposable` is most commonly encountered with library classes that wrap operating system (unmanaged) resources such as [`System.IO.Stream`][stream] and [`System.IO.TextReader`][text-reader]. (`Stream`s and `TextReader`s are covered in other exercises).\r\n\r\n```csharp\r\npublic class TextHandler : IDispoable\r\n{\r\n    private TextReader reader = new TextReader(...);\r\n\r\n    public void Dispose()\r\n    {\r\n        reader.Dispose();\r\n    }\r\n}\r\n```\r\n\r\nIf a class you are using implements the `IDispoable` interface then you must ensure that `Dispose()` is called (by use of [`catch` and `finally`][try-catch-finally] clauses) when the instance is no longer required. If a class has a member which implements `IDisposable` then it may well need to implement `IDisposable` itself so that `Dispose()` can be called to dispose of the `IDisposble`-implementing member.\r\n\r\n```csharp\r\npublic class Activity : IDisposable\r\n{\r\n    private MyResource myResource;\r\n\r\n    public Activity()\r\n    {\r\n        myResource = new MyResource();\r\n    }\r\n\r\n    public void Perform()\r\n    {\r\n        try\r\n        {\r\n            myResource.BeUseful();\r\n        }\r\n        catch (Exception)\r\n        {\r\n            myResource.Dispose();\r\n        }\r\n    }\r\n\r\n    public void Dispose()\r\n    {\r\n        myResource.Dispose();\r\n    }\r\n}\r\n```\r\n\r\nThe `IDisposable` interface may be useful even where no unmanaged resources are in the mix. Say you have a long-lived object which requires short-lived objects to register themselves with it and then unregister when they are no longer required. Implementing `IDisposable` on the short-lived object puts a developer using that class on notice that `Dispose()` needs to be called at the end of the short-lived object's life.\r\n\r\n## Dispose pattern\r\n\r\nYou will see references in the documentation to the [dispose pattern][dispose-pattern]. The _dispose pattern_ includes calling `Dispose()` from a class's [finalizer][finalizer] and ensuring that disposal of resources in base classes is handled correctly. The _dispose pattern_ is dealt with in a later exercise.\r\n\r\nThe _dispose pattern_ mostly relates to unmanaged resources. If you are using [P/Inovke mechanism][native-interoperability] and `extern` methods then you need to understand how and when to implement the dispose pattern. Most C# developers rarely have to deal directly with unmanaged resources in this way.\r\n\r\n[finalizer]: https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/destructors\r\n[using-statement]: https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-statement\r\n[idisposable]: https://docs.microsoft.com/en-us/dotnet/api/system.idisposable\r\n[dispose]: https://docs.microsoft.com/en-us/dotnet/api/system.idisposable.dispose\r\n[stream]: https://docs.microsoft.com/en-us/dotnet/api/system.io.stream\r\n[text-reader]: https://docs.microsoft.com/en-us/dotnet/api/system.io.textreader\r\n[native-interoperability]: https://docs.microsoft.com/en-us/dotnet/standard/native-interop/\r\n[dispose-pattern]: https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/implementing-dispose\r\n[garbage-collector]: https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/fundamentals\r\n[try-catch-finally]: https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch-finally\r\n",
    "introduction": "# Introduction\r\n\r\nIf a class implements the `IDisposable` interface then its `Dispose()` method must be called whenever an instance is no longer required. This is typically done from a `catch` or `finally` clause or from the `Dispose()` routine of some caller. `Dispose()` provides an opportunity for unmanaged resources such as operating system objects (which are not managed by the .NET runtime) to be released and the internal state of managed resources to be reset.\r\n"
  },
  "links": [
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/api/system.idisposable?view=netcore-3.1",
      "description": "idisposable"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/api/system.idisposable.dispose?view=netcore-3.1",
      "description": "dispose"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/fundamentals",
      "description": "garbage-collector"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/using-statement",
      "description": "using-statement"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/api/system.io.stream?view=netcore-3.1",
      "description": "stream"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/api/system.io.textreader?view=netcore-3.1",
      "description": "text-reader"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch-finally",
      "description": "try-catch-finally"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/implementing-dispose",
      "description": "dispose-pattern"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/destructors",
      "description": "finalizer"
    },
    {
      "url": "https://docs.microsoft.com/en-us/dotnet/standard/native-interop/",
      "description": "native-interoperability"
    }
  ]
}
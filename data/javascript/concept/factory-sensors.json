{
  "language": "javascript",
  "slug": "factory-sensors",
  "title": "Factory Sensors",
  "docs": {
    "introduction": "# Introduction\n\n## Errors\n\nErrors are useful to report when something is wrong or unexpected in a program or a piece of code.\n\nThey are javascript objects.\n\nThe main property of this object is `message`:\n\n```javascript\nconst error = new Error('Oops, something went wrong');\n\nconsole.log(error.message);\n// => \"Oops, something went wrong\"\n```\n\nUsing the `throw` syntax, you can throw an Error.\n\n```javascript\nthrow new Error('Oops');\n```\n\nWhen an error is thrown, the current execution is stopped and resumes in the first catch block of the call stack.\n\n```javascript\ntry {\n  throw new Error('Oops');\n} catch (error) {\n  console.log(error.message);\n  // => \"Oops\"\n}\n```\n\n## Inheritance\n\nInheritance is a way to create parent-child relationships between classes.\nThe child class (sometimes referred to as a _subclass_) has access to the behavior and data defined by the parent class (sometimes referred to as a _superclass_).\n\n```javascript\nclass Pet {\n  constructor(name) {\n    this.name = name;\n  }\n\n  introduce() {\n    console.log(`This is my pet, ${this.name}.`);\n  }\n}\n\nclass Dog extends Pet {}\n\nconst dog = new Dog('Otis');\ndog.introduce();\n// => This is my pet, Otis.\n```\n\nThe `extends` keyword in the child class declaration establishes a relationship with the parent class through the [prototype chain][prototype-chain].\n\nObjects created by the child's constructor will have the parent class's prototype in their prototype chain, providing access to any methods or data defined by the parent.\n\n```javascript\nconst dog = new Dog('Otis');\n\nDog.prototype.isPrototypeOf(dog); // => true\nPet.prototype.isPrototypeOf(dog); // => true\nPet.prototype.isPrototypeOf(Dog.prototype); // => true\n\nPet.prototype.hasOwnProperty('introduce'); // => true\nDog.prototype.hasOwnProperty('introduce'); // => false\ndog.hasOwnProperty('introduce'); // => false\n```\n\nAs with any class in JavaScript, subclasses can inherit from `Error` to create Custom errors by using the `extends` keyword.\nThe `instanceof` syntax will check if the error caught is an instance of a particular subclass of `Error`.\n\n```javascript\nclass CustomError extends Error {}\n\ntry {\n  // ... Code that may throw an error\n} catch (error) {\n  if (error instanceof CustomError) {\n    console.log('The error thrown is an instance of the CustomError');\n  }\n}\n```\n\n[prototype-chain]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain\n",
    "instructions": "# Instructions\n\nElena is the new quality manager of a newspaper factory. As she has just arrived in the company, she has decided to review some of the processes in the factory to see what could be improved.\nShe found out that technicians are doing a lot of quality checks by hand.\nShe sees there is a good opportunity for automation and asks you, a freelance developer, to develop a piece of software to monitor some of the machines.\n\n## 1. Monitor the humidity level of the room\n\nYour first mission is to write a piece of software to monitor the humidity level of the production room. There is already a sensor connected to the software of the company that returns periodically the humidity percentage of the room.\n\nYou need to implement a function in the software that will throw an error if the humidity percentage is too high.\nThe function should be called `checkHumidityLevel` and take the humidity percentage as a parameter.\n\nYou should throw an error (the message is not important) if the percentage exceeds 70%.\n\n```javascript\ncheckHumidityLevel(60);\n// => undefined\n```\n\n```javascript\ncheckHumidityLevel(100);\n// Throws an error\n```\n\n## 2. Detect overheating\n\nElena is very pleased with your first assignment and asks you to deal with the monitoring of the machines' temperature.\nWhile chatting with a technician, Greg, you are told that if the temperature of a machine exceeds 500°C, the technicians start worrying about overheating.\n\nThe machine is equipped with a sensor that measures its internal temperature.\nYou should know that the sensor is very sensitive and often breaks.\nIn this case, the technicians will need to change it.\n\nYour job is to implement a function `reportOverheating` that takes the temperature as a parameter and throws an error if the sensor is broken or if the machine starts overheating.\nKnowing that you will later need to react differently depending on the error, you need a mechanism to differentiate the two kinds of errors.\nYou could rely on the error messages, but this would make your code fragile as it would break if the message gets updated.\nSo to be able to do so properly, you'll throw instances of different error classes.\n\n- If the sensor is broken, the temperature will be `null`.\n  In this case, you should throw an `ArgumentError`.\n- When everything works, if the temperature exceeds 500°C, you should throw an `OverheatingError`.\n  This error class will be instantiated with a temperature argument.\n  Make sure that the `OverheatingError` you throw has a temperature property attached to it.\n\n```javascript\nreportOverheating(null);\n// Throws an ArgumentError\n```\n\n```javascript\nreportOverheating(800);\n// Throws an OverheatingError\n```\n\n## 3. Monitor the machine\n\nNow that your machine can detect errors, you will implement a function that reacts to those errors in different ways :\n\n- If the sensor is broken, you need to warn a technician\n- If the temperature is too high, you will either shut down the machine if the temperature exceeds 600°C or turn on a warning light if it is less than that.\n- If another error happens, you'll rethrow it.\n\nImplement a function `monitorTheMachine` that takes an argument `actions`.\n\n`actions` is an object that has 4 properties :\n\n| property           | description                                                                         |\n| ------------------ | ----------------------------------------------------------------------------------- |\n| `check`            | a _*function*_. Checks the temperature of the machine. It may throw various errors. |\n| `alertDeadSensor`  | a _*function*_. Alerts a technician that the temperature's sensor is dead.          |\n| `alertOverheating` | a _*function*_. Will turn on a warning light on the machine.                        |\n| `shutdown`         | a _*function*_. Will turn off the machine.                                          |\n\nThe `monitorTheMachine(actions)` function should internally call `check()`.\nIf that passes, the function should not return anything.\nIf that `throw`s an error, different behaviour is expected:\n\n| exception          | expected behaviour                   |\n| ------------------ | ------------------------------------ |\n| `ArgumentError`    | call the `alertDeadSensor` function. |\n| `OverheatingError` | execute the overheating protocol.    |\n| _(anything else)_  | rethrow the error                    |\n\n**Overheating protocol**\nIf the temperature is less than 600 °C, turn on the warning light by calling the `alertOverheating` function.\nIf the temperature exceeds 600 °C, the situation is critical, so call the `shutdown` function.\n\n```javascript\nmonitorTheMachine({\n  check,\n  alertDeadSensor,\n  alertOverheating,\n  shutdown,\n});\n```\n",
    "hints": "# Hints\n\n## 1. Monitor the humidity level of the room\n\n- You might want to use an [if...else condition][if-else-condition] to check if the humidity percentage is higher than the maximum allowed value.\n\n## 2. Detect overheating\n\n- This function should be very similar to the `checkHumidityLevel`. You might want to check [how to construct a new object][class-constructor] from a class\n\n## 3. Monitor the machine\n\n- Make sure that you handle all the errors in the catch block, you should have 4 different cases.\n\n[if-else-condition]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else\n[class-constructor]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/constructor\n"
  },
  "starter_code": "// @ts-check\n\nexport class ArgumentError extends Error {}\n\nexport class OverheatingError extends Error {\n  constructor(temperature) {\n    super(`The temperature is ${temperature} ! Overheating !`);\n    this.temperature = temperature;\n  }\n}\n\n/**\n * Check if the humidity level is too high.\n *\n * @param {number} humidityPercentage\n * @throws {Error}\n */\nexport function checkHumidityLevel(humidityPercentage) {\n  if (humidityPercentage > 70) {\n    throw new Error('Humidity level is too high');\n  }\n}\n\n/**\n * Check if the temperature is too high.\n *\n * @param {number|null} temperature\n * @throws {ArgumentError|OverheatingError}\n */\nexport function reportOverheating(temperature) {\n  if (temperature === null) {\n    throw new ArgumentError();\n  } else if (temperature > 500) {\n    throw new OverheatingError(temperature);\n  }\n}\n\n/**\n *  Triggers the needed action depending on the result of the machine check.\n *\n * @param {{\n * check: function,\n * alertDeadSensor: function,\n * alertOverheating: function,\n * shutdown: function\n * }} actions\n * @throws {ArgumentError|OverheatingError|Error}\n */\nexport function monitorTheMachine({\n  check,\n  alertDeadSensor,\n  alertOverheating,\n  shutdown,\n}) {\n  try {\n    check();\n  } catch (error) {\n    if (error instanceof ArgumentError) {\n      alertDeadSensor();\n    } else if (error instanceof OverheatingError) {\n      if (error.temperature > 600) {\n        shutdown();\n      } else {\n        alertOverheating();\n      }\n    } else {\n      throw error;\n    }\n  }\n}\n",
  "tests": "import { beforeEach, describe, expect, test, jest } from '@jest/globals';\nimport {\n  ArgumentError,\n  checkHumidityLevel,\n  monitorTheMachine,\n  OverheatingError,\n  reportOverheating,\n} from './factory-sensors';\n\ndescribe('checkHumidityLevel', () => {\n  test('should throw if the humidity percentage is 71', () => {\n    expect(() => checkHumidityLevel(71)).toThrow();\n  });\n\n  test('should throw if the humidity percentage is 100', () => {\n    expect(() => checkHumidityLevel(100)).toThrow();\n  });\n\n  test('should not throw if the humidity level is 70', () => {\n    expect(() => checkHumidityLevel(70)).not.toThrow();\n  });\n\n  test('should not throw if the humidity level is 53', () => {\n    expect(() => checkHumidityLevel(53)).not.toThrow();\n  });\n});\n\ndescribe('reportOverheating', () => {\n  test('should not throw if the temperature is 200°C', () => {\n    expect(() => reportOverheating(200)).not.toThrow();\n  });\n\n  test('should throw an ArgumentError if the temperature is null', () => {\n    expect(() => reportOverheating(null)).toThrow(ArgumentError);\n  });\n\n  test('should not throw if the temperature is 0°C', () => {\n    expect(() => reportOverheating(0)).not.toThrow();\n  });\n\n  test('should throw an OverheatingError if the temperature is 501°C', () => {\n    expect(() => reportOverheating(501)).toThrow(OverheatingError);\n\n    const getOverheatingErrorTemperature = () => {\n      try {\n        reportOverheating(501);\n      } catch (error) {\n        return error.temperature;\n      }\n    };\n\n    expect(getOverheatingErrorTemperature()).toBe(501);\n  });\n});\n\ndescribe('monitorTheMachine', () => {\n  const actions = {\n    check: jest.fn(),\n    alertDeadSensor: jest.fn(),\n    alertOverheating: jest.fn(),\n    shutdown: jest.fn(),\n  };\n\n  beforeEach(() => {\n    jest.resetAllMocks();\n  });\n\n  test('should call the check method once', () => {\n    monitorTheMachine(actions);\n\n    expect(actions.check).toHaveBeenCalledTimes(1);\n  });\n\n  test(\"should not call any action if the check doesn't throw\", () => {\n    monitorTheMachine(actions);\n\n    expect(actions.alertDeadSensor).not.toHaveBeenCalled();\n    expect(actions.alertOverheating).not.toHaveBeenCalled();\n    expect(actions.shutdown).not.toHaveBeenCalled();\n  });\n\n  test('should call only the alertDeadSensor if the check throws an ArgumentError', () => {\n    actions.check = jest.fn(() => {\n      throw new ArgumentError();\n    });\n    monitorTheMachine(actions);\n\n    expect(actions.alertDeadSensor).toHaveBeenCalledTimes(1);\n    expect(actions.alertOverheating).not.toHaveBeenCalled();\n    expect(actions.shutdown).not.toHaveBeenCalled();\n  });\n\n  test('should call only the shutdown action if the check throws an OverheatingError with a temperature of 651°C', () => {\n    actions.check = jest.fn(() => {\n      throw new OverheatingError(651);\n    });\n    monitorTheMachine(actions);\n\n    expect(actions.alertDeadSensor).not.toHaveBeenCalled();\n    expect(actions.alertOverheating).not.toHaveBeenCalled();\n    expect(actions.shutdown).toHaveBeenCalledTimes(1);\n  });\n\n  test('should call only the alertOverheating if the check throws an OverheatingError with a temperature of 530°C', () => {\n    actions.check = jest.fn(() => {\n      throw new OverheatingError(530);\n    });\n    monitorTheMachine(actions);\n\n    expect(actions.alertDeadSensor).not.toHaveBeenCalled();\n    expect(actions.alertOverheating).toHaveBeenCalledTimes(1);\n    expect(actions.shutdown).not.toHaveBeenCalled();\n  });\n\n  test('should rethrow the error if the check throws an unknown error', () => {\n    class UnknownError extends Error {}\n\n    actions.check = jest.fn(() => {\n      throw new UnknownError();\n    });\n\n    expect(() => monitorTheMachine(actions)).toThrow(UnknownError);\n\n    expect(actions.alertDeadSensor).not.toHaveBeenCalled();\n    expect(actions.alertOverheating).not.toHaveBeenCalled();\n    expect(actions.shutdown).not.toHaveBeenCalled();\n  });\n});\n"
}
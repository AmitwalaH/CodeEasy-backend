{
  "language": "javascript",
  "type": "practice",
  "slug": "bank-account",
  "title": "Bank Account",
  "docs": {
    "instructions": "# Instructions\n\nYour task is to implement bank accounts supporting opening/closing, withdrawals, and deposits of money.\n\nAs bank accounts can be accessed in many different ways (internet, mobile phones, automatic charges), your bank software must allow accounts to be safely accessed from multiple threads/processes (terminology depends on your programming language) in parallel.\nFor example, there may be many deposits and withdrawals occurring in parallel; you need to ensure there are no [race conditions][wikipedia] between when you read the account balance and set the new balance.\n\nIt should be possible to close an account; operations against a closed account must fail.\n\n[wikipedia]: https://en.wikipedia.org/wiki/Race_condition#In_software\n",
    "hints": ""
  },
  "starter_code": "//\n// This is only a SKELETON file for the 'Bank Account' exercise. It's been provided as a\n// convenience to get you started writing code faster.\n//\n\nexport class BankAccount {\n  constructor() {\n    throw new Error('Remove this line and implement the function');\n  }\n\n  open() {\n    throw new Error('Remove this line and implement the function');\n  }\n\n  close() {\n    throw new Error('Remove this line and implement the function');\n  }\n\n  deposit() {\n    throw new Error('Remove this line and implement the function');\n  }\n\n  withdraw() {\n    throw new Error('Remove this line and implement the function');\n  }\n\n  get balance() {\n    throw new Error('Remove this line and implement the function');\n  }\n}\n\nexport class ValueError extends Error {\n  constructor() {\n    super('Bank account error');\n  }\n}\n",
  "tests": "import { describe, expect, test, xtest } from '@jest/globals';\nimport { BankAccount, ValueError } from './bank-account';\n\ndescribe('Bank Account', () => {\n  test('newly opened account has zero balance', () => {\n    const account = new BankAccount();\n    account.open();\n    expect(account.balance).toEqual(0);\n  });\n\n  xtest('Single deposit', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(100);\n    expect(account.balance).toEqual(100);\n  });\n\n  xtest('Multiple deposits\"', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(100);\n    account.deposit(50);\n    expect(account.balance).toEqual(150);\n  });\n\n  xtest('Withdraw once', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(100);\n    account.withdraw(50);\n    expect(account.balance).toEqual(50);\n  });\n\n  xtest('Withdraw twice', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(100);\n    account.withdraw(20);\n    account.withdraw(80);\n    expect(account.balance).toEqual(0);\n  });\n\n  xtest('Can do multiple operations sequentially', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(100);\n    account.deposit(110);\n    account.withdraw(200);\n    account.deposit(60);\n    account.withdraw(50);\n    expect(account.balance).toEqual(20);\n  });\n\n  xtest('Cannot check balance of closed account', () => {\n    const account = new BankAccount();\n    account.open();\n    account.close();\n    expect(() => account.balance).toThrow(ValueError);\n  });\n\n  xtest('Cannot deposit into closed account', () => {\n    const account = new BankAccount();\n    account.open();\n    account.close();\n    expect(() => {\n      account.deposit(50);\n    }).toThrow(ValueError);\n  });\n\n  xtest('Cannot deposit into unopened account', () => {\n    const account = new BankAccount();\n    expect(() => {\n      account.deposit(50);\n    }).toThrow(ValueError);\n  });\n\n  xtest('Cannot withdraw from closed account', () => {\n    const account = new BankAccount();\n    account.open();\n    account.close();\n    expect(() => {\n      account.withdraw(50);\n    }).toThrow(ValueError);\n  });\n\n  xtest('Cannot close an account that was not opened', () => {\n    const account = new BankAccount();\n    expect(() => {\n      account.close();\n    }).toThrow(ValueError);\n  });\n\n  xtest('Cannot open an already opened account', () => {\n    const account = new BankAccount();\n    account.open();\n    expect(() => {\n      account.open();\n    }).toThrow(ValueError);\n  });\n\n  xtest('Reopened account does not retain balance', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(50);\n    account.close();\n    account.open();\n    expect(account.balance).toEqual(0);\n  });\n\n  xtest('Cannot withdraw more than deposited', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(25);\n    expect(() => {\n      account.withdraw(50);\n    }).toThrow(ValueError);\n  });\n\n  xtest('Cannot withdraw negative', () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(100);\n    expect(() => {\n      account.withdraw(-50);\n    }).toThrow(ValueError);\n  });\n\n  xtest('Cannot deposit negative', () => {\n    const account = new BankAccount();\n    account.open();\n    expect(() => {\n      account.deposit(-50);\n    }).toThrow(ValueError);\n  });\n\n  xtest('Can handle concurrent transactions', async () => {\n    const account = new BankAccount();\n    account.open();\n    account.deposit(1000);\n\n    for (let i = 0; i < 10; i++) {\n      await adjustBalanceConcurrently(account);\n      expect(account.balance).toEqual(1000);\n    }\n  });\n\n  function adjustBalanceConcurrently(account) {\n    const random = () => Math.floor(Math.random() * 10);\n\n    const tasks = Array.from(\n      { length: 1000 },\n      () =>\n        new Promise((resolve) => {\n          try {\n            account.deposit(5);\n            setTimeout(() => {\n              account.withdraw(5);\n              resolve();\n            }, random());\n          } catch (e) {\n            throw new Error(`Exception should not be thrown: ${e.message}`);\n          }\n        }),\n    );\n\n    return Promise.all(tasks);\n  }\n\n  xtest('Changing balance directly throws error', () => {\n    const account = new BankAccount();\n    account.open();\n    expect(() => {\n      account.balance = 100;\n    }).toThrow(Error);\n  });\n});\n"
}
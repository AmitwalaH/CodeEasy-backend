{
  "language": "javascript",
  "type": "practice",
  "slug": "ledger",
  "title": "Ledger",
  "docs": {
    "instructions": "# Instructions\n\nRefactor a ledger printer.\n\nThe ledger exercise is a refactoring exercise.\nThere is code that prints a nicely formatted ledger, given a locale (American or Dutch) and a currency (US dollar or euro).\nThe code however is rather badly written, though (somewhat surprisingly) it consistently passes the test suite.\n\nRewrite this code.\nRemember that in refactoring the trick is to make small steps that keep the tests passing.\nThat way you can always quickly go back to a working version.\nVersion control tools like git can help here as well.\n\nPlease keep a log of what changes you've made and make a comment on the exercise containing that log, this will help reviewers.\n",
    "hints": ""
  },
  "starter_code": "class LedgerEntry {\n  constructor() {\n    this.date = undefined;\n    this.description = undefined;\n    this.change = undefined;\n  }\n}\n\nexport function createEntry(date, description, change) {\n  let entry = new LedgerEntry();\n  entry.date = new Date(date);\n  entry.description = description;\n  entry.change = change;\n  return entry;\n}\n\nexport function formatEntries(currency, locale, entries) {\n  let table = '';\n  if (locale === 'en-US') {\n    // Generate Header Row\n    table +=\n      'Date'.padEnd(10, ' ') +\n      ' | ' +\n      'Description'.padEnd(25, ' ') +\n      ' | ' +\n      'Change'.padEnd(13, ' ') +\n      '\\n';\n\n    // Sort entries\n    entries.sort(\n      (a, b) =>\n        a.date - b.date ||\n        a.change - b.change ||\n        a.description.localeCompare(b.description),\n    );\n\n    entries.forEach((entry) => {\n      // Write entry date to table\n      const dateStr = `${(entry.date.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}/${entry.date\n        .getDate()\n        .toString()\n        .padStart(2, '0')}/${entry.date.getFullYear()}`;\n      table += `${dateStr} | `;\n\n      // Write entry description to table\n      const truncatedDescription =\n        entry.description.length > 25\n          ? `${entry.description.substring(0, 22)}...`\n          : entry.description.padEnd(25, ' ');\n      table += `${truncatedDescription} | `;\n\n      // Write entry change to table\n      let changeStr = '';\n      if (currency === 'USD') {\n        let formatingOptions = {\n          style: 'currency',\n          currency: 'USD',\n          //currencySign: 'accounting',\n          minimumFractionDigits: 2,\n          maximumFractionDigits: 2,\n        };\n        if (entry.change < 0) {\n          changeStr = `(${Math.abs(entry.change / 100).toLocaleString(\n            'en-US',\n            formatingOptions,\n          )})`;\n        } else {\n          changeStr = `${(entry.change / 100).toLocaleString(\n            'en-US',\n            formatingOptions,\n          )} `;\n        }\n      } else if (currency === 'EUR') {\n        let formatingOptions = {\n          style: 'currency',\n          currency: 'EUR',\n          minimumFractionDigits: 2,\n          maximumFractionDigits: 2,\n        };\n        if (entry.change < 0) {\n          changeStr = `(${Math.abs(entry.change / 100).toLocaleString(\n            'en-US',\n            formatingOptions,\n          )})`;\n        } else {\n          changeStr = `${(entry.change / 100).toLocaleString(\n            'en-US',\n            formatingOptions,\n          )} `;\n        }\n      }\n      table += changeStr.padStart(13, ' ');\n      table += '\\n';\n    });\n  } else if (locale === 'nl-NL') {\n    // Generate Header Row\n    table +=\n      'Datum'.padEnd(10, ' ') +\n      ' | ' +\n      'Omschrijving'.padEnd(25, ' ') +\n      ' | ' +\n      'Verandering'.padEnd(13, ' ') +\n      '\\n';\n\n    // Sort entries\n    entries.sort(\n      (a, b) =>\n        a.date - b.date ||\n        a.change - b.change ||\n        a.description.localeCompare(b.description),\n    );\n\n    entries.forEach((entry) => {\n      // Write entry date to table\n      const dateStr = `${entry.date.getDate().toString().padStart(2, '0')}-${(\n        entry.date.getMonth() + 1\n      )\n        .toString()\n        .padStart(2, '0')}-${entry.date.getFullYear()}`;\n      table += `${dateStr} | `;\n\n      // Write entry description to table\n      const truncatedDescription =\n        entry.description.length > 25\n          ? `${entry.description.substring(0, 22)}...`\n          : entry.description.padEnd(25, ' ');\n      table += `${truncatedDescription} | `;\n\n      // Write entry change to table\n      let changeStr = '';\n      if (currency === 'USD') {\n        let formatingOptions = {\n          style: 'currency',\n          currency: 'USD',\n          currencyDisplay: 'narrowSymbol',\n          minimumFractionDigits: 2,\n          maximumFractionDigits: 2,\n        };\n        changeStr = `${(entry.change / 100).toLocaleString(\n          'nl-NL',\n          formatingOptions,\n        )} `;\n      } else if (currency === 'EUR') {\n        let formatingOptions = {\n          style: 'currency',\n          currency: 'EUR',\n          currencyDisplay: 'narrowSymbol',\n          minimumFractionDigits: 2,\n          maximumFractionDigits: 2,\n        };\n        changeStr = `${(entry.change / 100).toLocaleString(\n          'nl-NL',\n          formatingOptions,\n        )} `;\n      }\n      table += changeStr.padStart(13, ' ');\n      table += '\\n';\n    });\n  }\n  return table.replace(/\\n$/, '');\n}\n",
  "tests": "import { describe, expect, test, xtest } from '@jest/globals';\nimport { createEntry, formatEntries } from './ledger';\n\ndescribe('Ledger', () => {\n  test('empty ledger', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [];\n    let expected = [\n      'Date       | Description               | Change       ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('one entry', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [createEntry('2015-01-01', 'Buy present', -1000)];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '01/01/2015 | Buy present               |      ($10.00)',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('credit and debit', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [\n      createEntry('2015-01-02', 'Get present', 1000),\n      createEntry('2015-01-01', 'Buy present', -1000),\n    ];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '01/01/2015 | Buy present               |      ($10.00)',\n      '01/02/2015 | Get present               |       $10.00 ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('final order tie breaker is change', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [\n      createEntry('2015-01-01', 'Something', 0),\n      createEntry('2015-01-01', 'Something', -1),\n      createEntry('2015-01-01', 'Something', 1),\n    ];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '01/01/2015 | Something                 |       ($0.01)',\n      '01/01/2015 | Something                 |        $0.00 ',\n      '01/01/2015 | Something                 |        $0.01 ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('overlong description is truncated', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [\n      createEntry('2015-01-01', 'Freude schoner Gotterfunken', -123456),\n    ];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '01/01/2015 | Freude schoner Gotterf... |   ($1,234.56)',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('euros', () => {\n    let currency = 'EUR';\n    let locale = 'en-US';\n    let entries = [createEntry('2015-01-01', 'Buy present', -1000)];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '01/01/2015 | Buy present               |      (€10.00)',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('Dutch locale', () => {\n    let currency = 'USD';\n    let locale = 'nl-NL';\n    let entries = [createEntry('2015-03-12', 'Buy present', 123456)];\n    let expected = [\n      'Datum      | Omschrijving              | Verandering  ',\n      '12-03-2015 | Buy present               |   $ 1.234,56 ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('Dutch locale and euros', () => {\n    let currency = 'EUR';\n    let locale = 'nl-NL';\n    let entries = [createEntry('2015-03-12', 'Buy present', 123456)];\n    let expected = [\n      'Datum      | Omschrijving              | Verandering  ',\n      '12-03-2015 | Buy present               |   € 1.234,56 ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('Dutch negative number with 3 digits before decimal point', () => {\n    let currency = 'USD';\n    let locale = 'nl-NL';\n    let entries = [createEntry('2015-03-12', 'Buy present', -12345)];\n    let expected = [\n      'Datum      | Omschrijving              | Verandering  ',\n      '12-03-2015 | Buy present               |    $ -123,45 ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('American negative number with 3 digits before decimal point', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [createEntry('2015-03-12', 'Buy present', -12345)];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '03/12/2015 | Buy present               |     ($123.45)',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n\n  xtest('multiple entries on same date ordered by description', () => {\n    let currency = 'USD';\n    let locale = 'en-US';\n    let entries = [\n      createEntry('2015-01-01', 'Get present', 1000),\n      createEntry('2015-01-01', 'Buy present', -1000),\n    ];\n    let expected = [\n      'Date       | Description               | Change       ',\n      '01/01/2015 | Buy present               |      ($10.00)',\n      '01/01/2015 | Get present               |       $10.00 ',\n    ].join('\\n');\n    expect(formatEntries(currency, locale, entries)).toEqual(expected);\n  });\n});\n"
}
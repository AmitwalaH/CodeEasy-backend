{
  "language": "python",
  "type": "practice",
  "slug": "ledger",
  "title": "Ledger",
  "docs": {
    "instructions": "# Instructions\r\n\r\nRefactor a ledger printer.\r\n\r\nThe ledger exercise is a refactoring exercise.\r\nThere is code that prints a nicely formatted ledger, given a locale (American or Dutch) and a currency (US dollar or euro).\r\nThe code however is rather badly written, though (somewhat surprisingly) it consistently passes the test suite.\r\n\r\nRewrite this code.\r\nRemember that in refactoring the trick is to make small steps that keep the tests passing.\r\nThat way you can always quickly go back to a working version.\r\nVersion control tools like git can help here as well.\r\n\r\nPlease keep a log of what changes you've made and make a comment on the exercise containing that log, this will help reviewers.\r\n",
    "hints": ""
  },
  "starter_code": "# -*- coding: utf-8 -*-\r\nfrom datetime import datetime\r\n\r\n\r\nclass LedgerEntry:\r\n    def __init__(self):\r\n        self.date = None\r\n        self.description = None\r\n        self.change = None\r\n\r\n\r\ndef create_entry(date, description, change):\r\n    entry = LedgerEntry()\r\n    entry.date = datetime.strptime(date, '%Y-%m-%d')\r\n    entry.description = description\r\n    entry.change = change\r\n    return entry\r\n\r\n\r\ndef format_entries(currency, locale, entries):\r\n    if locale == 'en_US':\r\n        # Generate Header Row\r\n        table = 'Date'\r\n        for _ in range(7):\r\n            table += ' '\r\n        table += '| Description'\r\n        for _ in range(15):\r\n            table += ' '\r\n        table += '| Change'\r\n        for _ in range(7):\r\n            table += ' '\r\n\r\n        while len(entries) > 0:\r\n            table += '\\n'\r\n\r\n            # Find next entry in order\r\n            min_entry_index = -1\r\n            for i in range(len(entries)):\r\n                entry = entries[i]\r\n                if min_entry_index < 0:\r\n                    min_entry_index = i\r\n                    continue\r\n                min_entry = entries[min_entry_index]\r\n                if entry.date < min_entry.date:\r\n                    min_entry_index = i\r\n                    continue\r\n                if (\r\n                    entry.date == min_entry.date and\r\n                    entry.change < min_entry.change\r\n                ):\r\n                    min_entry_index = i\r\n                    continue\r\n                if (\r\n                    entry.date == min_entry.date and\r\n                    entry.change == min_entry.change and\r\n                    entry.description < min_entry.description\r\n                ):\r\n                    min_entry_index = i\r\n                    continue\r\n            entry = entries[min_entry_index]\r\n            entries.pop(min_entry_index)\r\n\r\n            # Write entry date to table\r\n            month = entry.date.month\r\n            month = str(month)\r\n            if len(month) < 2:\r\n                month = '0' + month\r\n            date_str = month\r\n            date_str += '/'\r\n            day = entry.date.day\r\n            day = str(day)\r\n            if len(day) < 2:\r\n                day = '0' + day\r\n            date_str += day\r\n            date_str += '/'\r\n            year = entry.date.year\r\n            year = str(year)\r\n            while len(year) < 4:\r\n                year = '0' + year\r\n            date_str += year\r\n            table += date_str\r\n            table += ' | '\r\n\r\n            # Write entry description to table\r\n            # Truncate if necessary\r\n            if len(entry.description) > 25:\r\n                for i in range(22):\r\n                    table += entry.description[i]\r\n                table += '...'\r\n            else:\r\n                for i in range(25):\r\n                    if len(entry.description) > i:\r\n                        table += entry.description[i]\r\n                    else:\r\n                        table += ' '\r\n            table += ' | '\r\n\r\n            # Write entry change to table\r\n            if currency == 'USD':\r\n                change_str = ''\r\n                if entry.change < 0:\r\n                    change_str = '('\r\n                change_str += '$'\r\n                change_dollar = abs(int(entry.change / 100.0))\r\n                dollar_parts = []\r\n                while change_dollar > 0:\r\n                    dollar_parts.insert(0, str(change_dollar % 1000))\r\n                    change_dollar = change_dollar // 1000\r\n                if len(dollar_parts) == 0:\r\n                    change_str += '0'\r\n                else:\r\n                    while True:\r\n                        change_str += dollar_parts[0]\r\n                        dollar_parts.pop(0)\r\n                        if len(dollar_parts) == 0:\r\n                            break\r\n                        change_str += ','\r\n                change_str += '.'\r\n                change_cents = abs(entry.change) % 100\r\n                change_cents = str(change_cents)\r\n                if len(change_cents) < 2:\r\n                    change_cents = '0' + change_cents\r\n                change_str += change_cents\r\n                if entry.change < 0:\r\n                    change_str += ')'\r\n                else:\r\n                    change_str += ' '\r\n                while len(change_str) < 13:\r\n                    change_str = ' ' + change_str\r\n                table += change_str\r\n            elif currency == 'EUR':\r\n                change_str = ''\r\n                if entry.change < 0:\r\n                    change_str = '('\r\n                change_str += u'€'\r\n                change_euro = abs(int(entry.change / 100.0))\r\n                euro_parts = []\r\n                while change_euro > 0:\r\n                    euro_parts.insert(0, str(change_euro % 1000))\r\n                    change_euro = change_euro // 1000\r\n                if len(euro_parts) == 0:\r\n                    change_str += '0'\r\n                else:\r\n                    while True:\r\n                        change_str += euro_parts[0]\r\n                        euro_parts.pop(0)\r\n                        if len(euro_parts) == 0:\r\n                            break\r\n                        change_str += ','\r\n                change_str += '.'\r\n                change_cents = abs(entry.change) % 100\r\n                change_cents = str(change_cents)\r\n                if len(change_cents) < 2:\r\n                    change_cents = '0' + change_cents\r\n                change_str += change_cents\r\n                if entry.change < 0:\r\n                    change_str += ')'\r\n                else:\r\n                    change_str += ' '\r\n                while len(change_str) < 13:\r\n                    change_str = ' ' + change_str\r\n                table += change_str\r\n        return table\r\n    elif locale == 'nl_NL':\r\n        # Generate Header Row\r\n        table = 'Datum'\r\n        for _ in range(6):\r\n            table += ' '\r\n        table += '| Omschrijving'\r\n        for _ in range(14):\r\n            table += ' '\r\n        table += '| Verandering'\r\n        for _ in range(2):\r\n            table += ' '\r\n\r\n        while len(entries) > 0:\r\n            table += '\\n'\r\n\r\n            # Find next entry in order\r\n            min_entry_index = -1\r\n            for i in range(len(entries)):\r\n                entry = entries[i]\r\n                if min_entry_index < 0:\r\n                    min_entry_index = i\r\n                    continue\r\n                min_entry = entries[min_entry_index]\r\n                if entry.date < min_entry.date:\r\n                    min_entry_index = i\r\n                    continue\r\n                if (\r\n                    entry.date == min_entry.date and\r\n                    entry.change < min_entry.change\r\n                ):\r\n                    min_entry_index = i\r\n                    continue\r\n                if (\r\n                    entry.date == min_entry.date and\r\n                    entry.change == min_entry.change and\r\n                    entry.description < min_entry.description\r\n                ):\r\n                    min_entry_index = i\r\n                    continue\r\n            entry = entries[min_entry_index]\r\n            entries.pop(min_entry_index)\r\n\r\n            # Write entry date to table\r\n            day = entry.date.day\r\n            day = str(day)\r\n            if len(day) < 2:\r\n                day = '0' + day\r\n            date_str = day\r\n            date_str += '-'\r\n            month = entry.date.month\r\n            month = str(month)\r\n            if len(month) < 2:\r\n                month = '0' + month\r\n            date_str += month\r\n            date_str += '-'\r\n            year = entry.date.year\r\n            year = str(year)\r\n            while len(year) < 4:\r\n                year = '0' + year\r\n            date_str += year\r\n            table += date_str\r\n            table += ' | '\r\n\r\n            # Write entry description to table\r\n            # Truncate if necessary\r\n            if len(entry.description) > 25:\r\n                for i in range(22):\r\n                    table += entry.description[i]\r\n                table += '...'\r\n            else:\r\n                for i in range(25):\r\n                    if len(entry.description) > i:\r\n                        table += entry.description[i]\r\n                    else:\r\n                        table += ' '\r\n            table += ' | '\r\n\r\n            # Write entry change to table\r\n            if currency == 'USD':\r\n                change_str = '$ '\r\n                if entry.change < 0:\r\n                    change_str += '-'\r\n                change_dollar = abs(int(entry.change / 100.0))\r\n                dollar_parts = []\r\n                while change_dollar > 0:\r\n                    dollar_parts.insert(0, str(change_dollar % 1000))\r\n                    change_dollar = change_dollar // 1000\r\n                if len(dollar_parts) == 0:\r\n                    change_str += '0'\r\n                else:\r\n                    while True:\r\n                        change_str += dollar_parts[0]\r\n                        dollar_parts.pop(0)\r\n                        if len(dollar_parts) == 0:\r\n                            break\r\n                        change_str += '.'\r\n                change_str += ','\r\n                change_cents = abs(entry.change) % 100\r\n                change_cents = str(change_cents)\r\n                if len(change_cents) < 2:\r\n                    change_cents = '0' + change_cents\r\n                change_str += change_cents\r\n                change_str += ' '\r\n                while len(change_str) < 13:\r\n                    change_str = ' ' + change_str\r\n                table += change_str\r\n            elif currency == 'EUR':\r\n                change_str = u'€ '\r\n                if entry.change < 0:\r\n                    change_str += '-'\r\n                change_euro = abs(int(entry.change / 100.0))\r\n                euro_parts = []\r\n                while change_euro > 0:\r\n                    euro_parts.insert(0, str(change_euro % 1000))\r\n                    change_euro = change_euro // 1000\r\n                if len(euro_parts) == 0:\r\n                    change_str += '0'\r\n                else:\r\n                    while True:\r\n                        change_str += euro_parts[0]\r\n                        euro_parts.pop(0)\r\n                        if len(euro_parts) == 0:\r\n                            break\r\n                        change_str += '.'\r\n                change_str += ','\r\n                change_cents = abs(entry.change) % 100\r\n                change_cents = str(change_cents)\r\n                if len(change_cents) < 2:\r\n                    change_cents = '0' + change_cents\r\n                change_str += change_cents\r\n                change_str += ' '\r\n                while len(change_str) < 13:\r\n                    change_str = ' ' + change_str\r\n                table += change_str\r\n        return table\r\n\r\n",
  "tests": "# These tests are auto-generated with test data from:\r\n# https://github.com/exercism/problem-specifications/tree/main/exercises/ledger/canonical-data.json\r\n# File last updated on 2023-12-27\r\n\r\nimport unittest\r\n\r\nfrom ledger import (\r\n    format_entries,\r\n    create_entry,\r\n)\r\n\r\n\r\nclass LedgerTest(unittest.TestCase):\r\n    maxDiff = 5000\r\n\r\n    def test_empty_ledger(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = []\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_one_entry(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-01-01\", \"Buy present\", -1000),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"01/01/2015 | Buy present               |      ($10.00)\",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_credit_and_debit(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-01-02\", \"Get present\", 1000),\r\n            create_entry(\"2015-01-01\", \"Buy present\", -1000),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"01/01/2015 | Buy present               |      ($10.00)\",\r\n                \"01/02/2015 | Get present               |       $10.00 \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_final_order_tie_breaker_is_change(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-01-01\", \"Something\", 0),\r\n            create_entry(\"2015-01-01\", \"Something\", -1),\r\n            create_entry(\"2015-01-01\", \"Something\", 1),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"01/01/2015 | Something                 |       ($0.01)\",\r\n                \"01/01/2015 | Something                 |        $0.00 \",\r\n                \"01/01/2015 | Something                 |        $0.01 \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_overlong_description_is_truncated(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-01-01\", \"Freude schoner Gotterfunken\", -123456),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"01/01/2015 | Freude schoner Gotterf... |   ($1,234.56)\",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_euros(self):\r\n        currency = \"EUR\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-01-01\", \"Buy present\", -1000),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"01/01/2015 | Buy present               |      (€10.00)\",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_dutch_locale(self):\r\n        currency = \"USD\"\r\n        locale = \"nl_NL\"\r\n        entries = [\r\n            create_entry(\"2015-03-12\", \"Buy present\", 123456),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Datum      | Omschrijving              | Verandering  \",\r\n                \"12-03-2015 | Buy present               |   $ 1.234,56 \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_dutch_locale_and_euros(self):\r\n        currency = \"EUR\"\r\n        locale = \"nl_NL\"\r\n        entries = [\r\n            create_entry(\"2015-03-12\", \"Buy present\", 123456),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Datum      | Omschrijving              | Verandering  \",\r\n                \"12-03-2015 | Buy present               |   € 1.234,56 \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_dutch_negative_number_with_3_digits_before_decimal_point(self):\r\n        currency = \"USD\"\r\n        locale = \"nl_NL\"\r\n        entries = [\r\n            create_entry(\"2015-03-12\", \"Buy present\", -12345),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Datum      | Omschrijving              | Verandering  \",\r\n                \"12-03-2015 | Buy present               |    $ -123,45 \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_american_negative_number_with_3_digits_before_decimal_point(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-03-12\", \"Buy present\", -12345),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"03/12/2015 | Buy present               |     ($123.45)\",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n\r\n    def test_multiple_entries_on_same_date_ordered_by_description(self):\r\n        currency = \"USD\"\r\n        locale = \"en_US\"\r\n        entries = [\r\n            create_entry(\"2015-01-01\", \"Get present\", 1000),\r\n            create_entry(\"2015-01-01\", \"Buy present\", -1000),\r\n        ]\r\n        expected = \"\\n\".join(\r\n            [\r\n                \"Date       | Description               | Change       \",\r\n                \"01/01/2015 | Buy present               |      ($10.00)\",\r\n                \"01/01/2015 | Get present               |       $10.00 \",\r\n            ]\r\n        )\r\n        self.assertEqual(format_entries(currency, locale, entries), expected)\r\n"
}
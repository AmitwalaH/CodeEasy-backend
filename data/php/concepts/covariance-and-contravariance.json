{
  "language": "php",
  "slug": "covariance-and-contravariance",
  "title": "Covariance And Contravariance",
  "docs": {
    "about": "## Covariance and Contravariance\r\n\r\nWhen utilizing union types you must be aware of the concepts of covariance and contravariance. These are explained in the [documentation](https://www.php.net/manual/en/language.oop5.variance.php) but these examples may help.\r\n\r\nSuppose we have a Calculator class utilizing a function like the above example:\r\n\r\n```php\r\nclass Calculator\r\n{\r\n    public function add(int|float $x, int|float $y): int|float\r\n    {\r\n        return $x + $y;\r\n    }\r\n}\r\n```\r\n\r\nIf you were to extend the class, you are allowed to change the parameter types and return types, but only according to the following rules.\r\n\r\nFirst, parameter types may be \"wider\", meaning they can accept more types than the base class. For example, this is allowed:\r\n\r\n```php\r\nclass StringCalc extends Foo\r\n{\r\n    public function add(float|int|string $x, float|int|string $y): int|float\r\n    {\r\n        if (!is_numeric($x) || !is_numeric($y)) {\r\n            throw new \\InvalidArgumentException('$x and $y must be numeric');\r\n        }\r\n        return $x + $y;\r\n    }\r\n}\r\n```\r\n\r\nWe could substitute `StringCalc` in place of an original `Calculator` and everything would still work. The caller would still be able to send in the `float` or `int` it originally could, and the return type would still be the expected `int` or `float`.\r\n\r\nSimilarly, you can narrow the return type, meaning make it more specific by removing types from the union. This example takes advantage of this rule:\r\n\r\n```php\r\nclass IntCalc extends Calculator\r\n{\r\n    public function add(float|int $x, float|int $y) : int\r\n    {\r\n        return (int)($x + $y);\r\n    }\r\n}\r\n```\r\n\r\nSince the `IntCalc` still accepts `int` and `float` it can still substitute for an original `Calculator` with no problems.\r\n\r\nTo read more about what is and isn't allowed, you can refer to the [Liskov Substitution Principal (LSP)](https://en.wikipedia.org/wiki/Liskov_substitution_principle).\r\n\r\nFor an example of what would not be allowed, take a look at `InvalidCalc` below:\r\n\r\n```php\r\nclass InvalidCalc extends Calculator\r\n{\r\n    public function add(int $x, int $y) : int|float|string\r\n    {\r\n        // Declaration must be compatible with Calculator->add(x: float|int, y: float|int)\r\n\r\n        // Return type declaration must be compatible with Calculator->add(x: float|int, y: float|int) : float|int\r\n    }\r\n}\r\n```\r\n\r\nThe `InvalidCalc` class will not compile and has two problems. By reducing what is allowed as a parameter, `InvalidCalc` could not stand in for the original `Calculator` because it no longer accepts `float`. Additionally, it now could return a `string` which is also not within the allowed return types of the original class. \r\n",
    "introduction": "# Introduction\r\n\r\nThe concepts of covariance and contravariance in PHP are important as PHP enforces these rules are followed when extending classes or interfaces.\r\n\r\nCovariance preserves the relationship between two types, while contravariance reverses that relationship. In short it means that when extending classes and overriding functions, you may allow more or less specific types for your method's parameters, and you may return fewer or more specific types from the method.\r\n\r\n## Examples\r\n\r\nConsider the following class:\r\n\r\n```php\r\nclass Calculator \r\n{\r\n    public function add(int $x, int $y): int \r\n    {\r\n        return $x + $y;\r\n    }\r\n}\r\n```\r\n\r\nIf we extend the class, we can allow more parameter types than originally declared, but we cannot return anything other than the original return types.\r\n\r\n```php\r\nclass Floatulator extends Calculator\r\n{\r\n    // This is valid\r\n    public function add(int|float $x, int|float $y): int \r\n    {\r\n        return (int)($x + $y);\r\n    }\r\n}\r\n```\r\n\r\nThe following extended class is not valid because returning additional or wider types are not allowed:\r\n\r\n```php\r\nclass BrokenCalculator extends Calculator \r\n{\r\n    // This is invalid and will not compile\r\n    public function add(int|float $x, int|float $y): int|float{\r\n        return $x + $y;\r\n    }\r\n}\r\n```\r\n"
  },
  "links": [
    {
      "url": "https://www.php.net/manual/en/language.oop5.variance.php",
      "description": "PHP Manual on Covariance and Contravariance"
    },
    {
      "url": "https://www.php.net/manual/en/language.types.declarations.php#language.types.declarations.union",
      "description": "Union Type Declarations"
    }
  ]
}
{
  "language": "php",
  "slug": "bank-account",
  "docs": {
    "instructions": "# Instructions\r\n\r\nYour task is to implement bank accounts supporting opening/closing, withdrawals, and deposits of money.\r\n\r\nAs bank accounts can be accessed in many different ways (internet, mobile phones, automatic charges), your bank software must allow accounts to be safely accessed from multiple threads/processes (terminology depends on your programming language) in parallel.\r\nFor example, there may be many deposits and withdrawals occurring in parallel; you need to ensure there are no [race conditions][wikipedia] between when you read the account balance and set the new balance.\r\n\r\nIt should be possible to close an account; operations against a closed account must fail.\r\n\r\n[wikipedia]: https://en.wikipedia.org/wiki/Race_condition#In_software\r\n",
    "instructions_append": "# Instructions append\r\n\r\n## Concurrency\r\nThe PHP version of this exercise does not require using concurrency and the exercises testing concurrency specifically have been omitted.\r\n",
    "hints": ""
  },
  "starter_code": {
    "BankAccount.php": "<?php\r\n\r\n/*\r\n * By adding type hints and enabling strict type checking, code can become\r\n * easier to read, self-documenting and reduce the number of potential bugs.\r\n * By default, type declarations are non-strict, which means they will attempt\r\n * to change the original type to match the type specified by the\r\n * type-declaration.\r\n *\r\n * In other words, if you pass a string to a function requiring a float,\r\n * it will attempt to convert the string value to a float.\r\n *\r\n * To enable strict mode, a single declare directive must be placed at the top\r\n * of the file.\r\n * This means that the strictness of typing is configured on a per-file basis.\r\n * This directive not only affects the type declarations of parameters, but also\r\n * a function's return type.\r\n *\r\n * For more info review the Concept on strict type checking in the PHP track\r\n * <link>.\r\n *\r\n * To disable strict typing, comment out the directive below.\r\n */\r\n\r\ndeclare(strict_types=1);\r\n\r\nclass BankAccount\r\n{\r\n    public function open()\r\n    {\r\n        throw new \\BadMethodCallException(sprintf('Implement the %s method', __FUNCTION__));\r\n    }\r\n\r\n    public function close()\r\n    {\r\n        throw new \\BadMethodCallException(sprintf('Implement the %s method', __FUNCTION__));\r\n    }\r\n\r\n    public function balance(): int\r\n    {\r\n        throw new \\BadMethodCallException(sprintf('Implement the %s method', __FUNCTION__));\r\n    }\r\n\r\n    public function deposit(int $amt)\r\n    {\r\n        throw new \\BadMethodCallException(sprintf('Implement the %s method', __FUNCTION__));\r\n    }\r\n\r\n    public function withdraw(int $amt)\r\n    {\r\n        throw new \\BadMethodCallException(sprintf('Implement the %s method', __FUNCTION__));\r\n    }\r\n}\r\n"
  },
  "tests": {
    "BankAccountTest.php": "<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nuse PHPUnit\\Framework\\TestCase;\r\nuse PHPUnit\\Framework\\Attributes\\TestDox;\r\n\r\nclass BankAccountTest extends TestCase\r\n{\r\n    public static function setUpBeforeClass(): void\r\n    {\r\n        require_once 'BankAccount.php';\r\n    }\r\n\r\n    /**\r\n     * uuid: 983a1528-4ceb-45e5-8257-8ce01aceb5ed\r\n     */\r\n    #[TestDox('Newly opened account has zero balance')]\r\n    public function testNewlyOpenedAccountHasZeroBalance(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $this->assertEquals(0, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: e88d4ec3-c6bf-4752-8e59-5046c44e3ba7\r\n     */\r\n    #[TestDox('Single deposit')]\r\n    public function testSingleDeposit(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(100);\r\n        $this->assertEquals(100, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: 3d9147d4-63f4-4844-8d2b-1fee2e9a2a0d\r\n     */\r\n    #[TestDox('Multiple deposits')]\r\n    public function testMultipleDeposits(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(100);\r\n        $subject->deposit(50);\r\n        $this->assertEquals(150, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: 08f1af07-27ae-4b38-aa19-770bde558064\r\n     */\r\n    #[TestDox('Withdraw once')]\r\n    public function testWithdrawOnce(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(100);\r\n        $subject->withdraw(75);\r\n        $this->assertEquals(25, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: 6f6d242f-8c31-4ac6-8995-a90d42cad59f\r\n     */\r\n    #[TestDox('Withdraw twice')]\r\n    public function testWithdrawTwice(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(100);\r\n        $subject->withdraw(80);\r\n        $subject->withdraw(20);\r\n        $this->assertEquals(0, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: 45161c94-a094-4c77-9cec-998b70429bda\r\n     */\r\n    #[TestDox('Can do multiple operations sequentially')]\r\n    public function testCanDoMultipleOperationsSequentially(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(100);\r\n        $subject->deposit(110);\r\n        $subject->withdraw(200);\r\n        $subject->deposit(60);\r\n        $subject->withdraw(50);\r\n        $this->assertEquals(20, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: f9facfaa-d824-486e-8381-48832c4bbffd\r\n     */\r\n    #[TestDox('Cannot check balance of closed account')]\r\n    public function testCannotCheckBalanceOfClosedAccount(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->close();\r\n        $this->expectException(Exception::class);\r\n        $this->expectExceptionMessage('account not open');\r\n        $subject->balance();\r\n    }\r\n\r\n    /**\r\n     * uuid: 7a65ba52-e35c-4fd2-8159-bda2bde6e59c\r\n     */\r\n    #[TestDox('Cannot deposit into closed account')]\r\n    public function testCannotDepositIntoClosedAccount(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->close();\r\n        $this->expectException(Exception::class);\r\n        $this->expectExceptionMessage('account not open');\r\n        $subject->deposit(50);\r\n    }\r\n\r\n    /**\r\n     * uuid: a0a1835d-faae-4ad4-a6f3-1fcc2121380b\r\n     */\r\n    #[TestDox('Cannot deposit into unopened account')]\r\n    public function testCannotDepositIntoUnopenedAccount(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $this->expectException(Exception::class);\r\n        $this->expectExceptionMessage('account not open');\r\n        $subject->deposit(50);\r\n    }\r\n\r\n    /**\r\n     * uuid: 570dfaa5-0532-4c1f-a7d3-0f65c3265608\r\n     */\r\n    #[TestDox('Cannot withdraw from closed account')]\r\n    public function testCannotWithdrawFromClosedAccount(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->close();\r\n        $this->expectException(Exception::class);\r\n        $this->expectExceptionMessage('account not open');\r\n        $subject->withdraw(50);\r\n    }\r\n\r\n    /**\r\n     * uuid: c396d233-1c49-4272-98dc-7f502dbb9470\r\n     */\r\n    #[TestDox('Cannot close an account that was not opened')]\r\n    public function testCannotCloseAnAccountThatWasNotOpened(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $this->expectException(Exception::class);\r\n        $this->expectExceptionMessage('account not open');\r\n        $subject->close();\r\n    }\r\n\r\n    /**\r\n     * uuid: c06f534f-bdc2-4a02-a388-1063400684de\r\n     */\r\n    #[TestDox('Cannot open an already opened account')]\r\n    public function testCannotOpenAnAlreadyOpenedAccount(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $this->expectException(Exception::class);\r\n        $this->expectExceptionMessage('account already open');\r\n        $subject->open();\r\n    }\r\n\r\n    /**\r\n     * uuid: 0722d404-6116-4f92-ba3b-da7f88f1669c\r\n     */\r\n    #[TestDox('Reopened account does not retain balance')]\r\n    public function testReopenedAccountDoesNotRetainBalance(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(50);\r\n        $subject->close();\r\n        $subject->open();\r\n        $this->assertEquals(0, $subject->balance());\r\n    }\r\n\r\n    /**\r\n     * uuid: ec42245f-9361-4341-8231-a22e8d19c52f\r\n     */\r\n    #[TestDox('Cannot withdraw more than deposited')]\r\n    public function testCannotWithdrawMoreThanDeposited(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(25);\r\n        $this->expectException(InvalidArgumentException::class);\r\n        $this->expectExceptionMessage('amount must be less than balance');\r\n        $subject->withdraw(50);\r\n    }\r\n\r\n    /**\r\n     * uuid: 4f381ef8-10ef-4507-8e1d-0631ecc8ee72\r\n     */\r\n    #[TestDox('Cannot withdraw negative')]\r\n    public function testCannotWithdrawNegative(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $subject->deposit(100);\r\n        $this->expectException(InvalidArgumentException::class);\r\n        $this->expectExceptionMessage('amount must be greater than 0');\r\n        $subject->withdraw(-50);\r\n    }\r\n\r\n    /**\r\n     * uuid: d45df9ea-1db0-47f3-b18c-d365db49d938\r\n     */\r\n    #[TestDox('Cannot deposit negative')]\r\n    public function testCannotDepositNegative(): void\r\n    {\r\n        $subject = new BankAccount();\r\n        $subject->open();\r\n        $this->expectException(InvalidArgumentException::class);\r\n        $this->expectExceptionMessage('amount must be greater than 0');\r\n        $subject->deposit(-50);\r\n    }\r\n}\r\n"
  }
}
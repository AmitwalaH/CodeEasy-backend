{
  "language": "php",
  "slug": "city-office",
  "docs": {
    "introduction": "# Introduction\r\n\r\n## Type Declaration\r\n\r\nType declarations in PHP provide type assertions at run time for function arguments, return values and class properties.\r\nOn functions, a `void` return type can be added to indicate that no value is returned from the function.\r\nDeclared types also serve as run time assertions that functions are returning a reasonably typed response.\r\n\r\n```php\r\n<?php\r\n\r\nclass Driver\r\n{\r\n    private int $serial_number;\r\n\r\n    public function setSerialNumber(int $number): void\r\n    {\r\n        $this->serial_number = $number;\r\n    }\r\n\r\n    public function getSerialNumber(): int\r\n    {\r\n        return $this->serial_number; \r\n    }\r\n}\r\n\r\n$driver = new Driver();\r\n$driver->setSerialNumber(\"Version 1b\"); // This will throw a TypeError\r\n```\r\n\r\n### Type Unions\r\n\r\nIf a function argument, return value or class property can be more than one type a type union may be declared.\r\n\r\n```php\r\n<?php\r\n\r\nclass IdentityCard\r\n{\r\n    private int|null $id = null;\r\n\r\n    public function assign(int|float $id): void\r\n    {\r\n        $this->id = intval($id);\r\n    }\r\n}\r\n\r\n$card = new IdentityCard();\r\n$card->assign(5.0);\r\n```\r\n\r\n### Mixed Types\r\n\r\nWhen working with code, we may not be able to specify a type.\r\nStarting in PHP 8.0,an escape-hatch type named `mixed` is provided.\r\nMixed is equivalent to a type union of `object|resource|array|string|float|int|bool|null`.\r\n",
    "instructions": "# Instructions\r\n\r\nYou have been working in the city office for a while, and you have developed a set of tools that speed up your day-to-day work, for example with filling out forms.\r\n\r\nNow, a new colleague is joining you, and you realized your tools might not be self-explanatory.\r\nThere are a lot of weird conventions in your office, like always filling out forms with uppercase letters and avoiding leaving fields empty.\r\n\r\nAs a first step you decide to add PHP type declarations so that it is easier for your new colleague to hop right in and start using your tools.\r\n\r\n## 1. Declare the types for the Address class\r\n\r\nAdd property type declarations to each of the `Address` class properties declared.\r\nEach class property should be declared as a string.\r\n\r\n## 2. Declare the types to fill out the form with blank values\r\n\r\nAdd a parameter type declaration and a return type declaration to the `blanks` method in the `Form` class.\r\nThe method should take in an integer length, and return a string representation of the blank line.\r\n\r\n## 3. Declare the type when splitting a value into separate letters\r\n\r\nAdd a parameter type declaration and a return type declaration to the `letters` method in the `Form` class.\r\nThe method should take in a string, representing words, and return an array of letters.\r\n\r\n## 4. Declare the type when checking if a value will fit into a form\r\n\r\nAdd parameter type declarations and a return type declaration to the `checkLength` method in the `Form` class.\r\nThe method should take in a string word, and an integer maximum length, and return a true or false value.\r\n\r\n## 5. Declare the type when formatting an address in the form\r\n\r\nAdd a parameter type declaration, making use of the `Address` class updated previously, and a return type declaration to the `formatAddress` method in the `Form` class.\r\nThe method should take in an `Address` and return a formatted string.\r\n",
    "hints": "# Instructions\r\n\r\nReview the [type declaration][type-declaration] PHP documentation.\r\n\r\n## 1. Document the types for the Address class\r\n\r\n- In PHP, typings for primitive values match their name, see the [introduction to types][type-intro]\r\n\r\n## 2. Document the types to fill out the form with blank values\r\n\r\n- In PHP, typings for primitive values match their name, see the [introduction to types][type-intro]\r\n\r\n## 3. Document the type when splitting a value into separate letters\r\n\r\n- In PHP, typings for primitive values match their name, see the [introduction to types][type-intro]\r\n\r\n## 4. Document the type when checking if a value will fit into a form\r\n\r\n- In PHP, typings for primitive values match their name, see the [introduction to types][type-intro]\r\n\r\n## 5. Document the type when formatting an address in the form\r\n\r\n- In PHP, types declarations for classes may use either `object` or the specific class name as the declared type.\r\n\r\n[type-declaration]: https://www.php.net/manual/en/language.types.declarations.php\r\n[type-intro]: https://www.php.net/manual/en/language.types.intro.php\r\n"
  },
  "starter_code": {
    "Address.php": "<?php\r\n\r\nclass Address\r\n{\r\n    public $street;\r\n    public $postal_code;\r\n    public $city;\r\n}\r\n",
    "Form.php": "<?php\r\n\r\nclass Form\r\n{\r\n    function blanks($length)\r\n    {\r\n        return str_repeat(\" \", $length);\r\n    }\r\n\r\n    function letters($word)\r\n    {\r\n        return mb_str_split($word);\r\n    }\r\n\r\n    function checkLength($word, $max_length)\r\n    {\r\n        $difference = mb_strlen($word) - $max_length;\r\n        return $difference <= 0;\r\n    }\r\n\r\n    function formatAddress($address)\r\n    {\r\n        $formatted_street = mb_strtoupper($address->street);\r\n        $formatted_postal_code = mb_strtoupper($address->postal_code);\r\n        $formatted_city = mb_strtoupper($address->city);\r\n\r\n        return <<<FORMATTED_ADDRESS\r\n            $formatted_street\r\n            $formatted_postal_code $formatted_city\r\n            FORMATTED_ADDRESS;\r\n    }\r\n}\r\n",
    "ReflectionAssertions.php": "<?php\r\n\r\ntrait ReflectionAssertions\r\n{\r\n    private function assertProperty(\r\n        string $class_name,\r\n        string $property_name,\r\n        array $assertions = []\r\n    ) {\r\n        $reflector = new ReflectionClass($class_name);\r\n        $assertions = $this->getAssertionDefaults($assertions);\r\n\r\n        try {\r\n            $property = $reflector->getProperty($property_name);\r\n        } catch (ReflectionException) {\r\n            $this->fail(\r\n                \"Property '$property_name' missing from class '{$class_name}'\"\r\n            );\r\n        };\r\n\r\n        $this->assertType($property, $assertions);\r\n        $this->assertDefault($property, $assertions);\r\n    }\r\n\r\n    private function assertMethodParameter(\r\n        string $class_name,\r\n        string $method_name,\r\n        string $parameter_name,\r\n        int $parameter_index,\r\n        array $assertions = []\r\n    ): void {\r\n        $reflector = new ReflectionClass($class_name);\r\n        $assertions = $this->getAssertionDefaults($assertions);\r\n\r\n        try {\r\n            $method = $reflector->getMethod($method_name);\r\n        } catch (ReflectionException) {\r\n            $this->fail(\r\n                \"Method '$method_name' missing from class '$class_name'\"\r\n            );\r\n        };\r\n\r\n        $parameter = $method->getParameters()[$parameter_index] ?? null;\r\n\r\n        if (is_null($parameter)) {\r\n            $this->fail(\r\n                \"Method '$parameter_name' missing parameter $parameter_index\"\r\n                . \" named '$parameter_name'\"\r\n            );\r\n        }\r\n\r\n        if ($parameter->getName() !== $parameter_name) {\r\n            $this->fail(\r\n                \"Method '$method_name' parameter $parameter_index expected to be\"\r\n                . \" named '$parameter_name', got '{$parameter->getName()}'\"\r\n            );\r\n        }\r\n\r\n        $this->assertType($parameter, $assertions);\r\n        $this->assertDefault($parameter, $assertions);\r\n    }\r\n\r\n    private function assertMethodReturnType(\r\n        string $class_name,\r\n        string $method_name,\r\n        array $assertions\r\n    ): void {\r\n        $reflector = new ReflectionClass($class_name);\r\n        $assertions = $this->getAssertionDefaults($assertions);\r\n\r\n        try {\r\n            $method = $reflector->getMethod($method_name);\r\n        } catch (ReflectionException) {\r\n            $this->fail(\r\n                \"Method '$method_name' missing from class '$class_name'\"\r\n            );\r\n        };\r\n\r\n        if ($assertions['has_type']) {\r\n            $this->assertTrue(\r\n                $method->hasReturnType(),\r\n                \"$class_name::$method_name should have a return type declared\"\r\n            );\r\n            $method_return_type = $method->getReturnType();\r\n            $this->assertEquals(\r\n                $assertions['type_name'],\r\n                $method_return_type->getName(),\r\n                \"$class_name::$method_name should have a return type declared\"\r\n                . \" as '{$assertions['type_name']}', got\"\r\n                . \" '{$method_return_type->getName()}'\"\r\n            );\r\n            $this->assertEquals(\r\n                $assertions['type_allows_null'],\r\n                $method->getReturnType()->allowsNull(),\r\n                $assertions['type_allows_null']\r\n                    ? \"$class_name::$method_name should have a nullable return type declared\"\r\n                    : \"$class_name::$method_name should have a non-nullable return type declared\"\r\n            );\r\n        } else {\r\n            $this->assertFalse($method->hasReturnType());\r\n            $this->assertNull($method->getReturnType());\r\n        }\r\n    }\r\n\r\n    private function getAssertionDefaults(array $assertions): array\r\n    {\r\n        return array_merge([\r\n            'has_type' => false,\r\n            'has_default_value' => false,\r\n        ], $assertions);\r\n    }\r\n\r\n    private function assertType(\r\n        ReflectionProperty|ReflectionParameter $reflector,\r\n        array $assertions\r\n    ): void {\r\n        $reflector_type_name = $this->getReflectionTypeName($reflector);\r\n        $name = $reflector->getName();\r\n\r\n        if ($assertions['has_type']) {\r\n            $this->assertTrue(\r\n                $reflector->hasType(),\r\n                \"$reflector_type_name '$name' should have a type declared\"\r\n            );\r\n            $reflected_type = $reflector->getType();\r\n            $this->assertEquals(\r\n                $assertions['type_name'],\r\n                $reflected_type->getName(),\r\n                \"$reflector_type_name '$name' should be declared as a\"\r\n                . \" '{$assertions['type_name']}', got\"\r\n                . \" '{$reflected_type->getName()}'\"\r\n            );\r\n            $this->assertEquals(\r\n                $assertions['type_allows_null'],\r\n                $reflected_type->allowsNull(),\r\n                \"$reflector_type_name '$name' should not be declared to allow null\"\r\n            );\r\n        } else {\r\n            $this->assertFalse(\r\n                $reflector->hasType(),\r\n                \"$reflector_type_name '$name' should not have a type declared\"\r\n            );\r\n        }\r\n    }\r\n\r\n    private function assertDefault(\r\n        ReflectionProperty|ReflectionParameter $reflector,\r\n        array $assertions\r\n    ): void {\r\n        $reflector_type_name = $this->getReflectionTypeName($reflector);\r\n        $has_default_value_method = $reflector_type_name === 'Property'\r\n            ? 'hasDefaultValue'\r\n            : 'isDefaultValueAvailable';\r\n        $name = $reflector->getName();\r\n\r\n        if ($assertions['has_default_value']) {\r\n            $this->assertTrue(\r\n                $reflector->$has_default_value_method()\r\n            );\r\n            $this->assertEquals(\r\n                $assertions['default_value'],\r\n                $reflector->getDefaultValue(),\r\n                \"$reflector_type_name '$name' should have a default value\"\r\n                . \" declared as '{$assertions['default_value']}', got\"\r\n                . \" '{$reflector->getDefaultValue()}'\"\r\n            );\r\n        } else {\r\n            if ($assertions['has_type'] === false) {\r\n                $this->assertTrue($reflector->hasDefaultValue());\r\n                $this->assertNull($reflector->getDefaultValue());\r\n            } else {\r\n                $this->assertFalse(\r\n                    $reflector->$has_default_value_method(),\r\n                    \"$reflector_type_name '$name' should not have a default value declared\"\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    private function getReflectionTypeName(\r\n        ReflectionParameter | ReflectionProperty $reflector\r\n    ): string {\r\n        return preg_replace('/^Reflection/', '', get_class($reflector));\r\n    }\r\n}\r\n"
  },
  "tests": {
    "CityOfficeTest.php": "<?php\r\n\r\nuse PHPUnit\\Framework\\TestCase;\r\nuse PHPUnit\\Framework\\Attributes\\TestDox;\r\n\r\nrequire_once 'ReflectionAssertions.php';\r\nrequire_once 'Address.php';\r\nrequire_once 'Form.php';\r\n\r\nclass CityOfficeTest extends TestCase\r\n{\r\n    use ReflectionAssertions;\r\n\r\n    /**\r\n     * @task_id 1\r\n     */\r\n    #[TestDox('specify a string type for Address::$street')]\r\n    public function testTypeOfAddressStreetProperty()\r\n    {\r\n        $this->assertProperty(\r\n            class_name: Address::class,\r\n            property_name: 'street',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 1\r\n     */\r\n    #[TestDox('specify a string type for Address::$postal_code')]\r\n    public function testTypeOfAddressPostalCodeProperty()\r\n    {\r\n        $this->assertProperty(\r\n            class_name: Address::class,\r\n            property_name: 'postal_code',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 1\r\n     */\r\n    #[TestDox('specify a string type for Address::$city')]\r\n    public function testTypeOfAddressCityProperty()\r\n    {\r\n        $this->assertProperty(\r\n            class_name: Address::class,\r\n            property_name: 'city',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 2\r\n     */\r\n    #[TestDox('specify an int type for Form::blanks length parameter')]\r\n    public function testParameterTypeOfFormBlanksLengthParameter()\r\n    {\r\n        $this->assertMethodParameter(\r\n            class_name: Form::class,\r\n            method_name: 'blanks',\r\n            parameter_name: 'length',\r\n            parameter_index: 0,\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'int',\r\n                'type_allows_null' => false,\r\n                'has_default_value' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 2\r\n     */\r\n    #[TestDox('specify an int type for Form::blanks return type')]\r\n    public function testParameterTypeOfFormBlanksReturnType()\r\n    {\r\n        $this->assertMethodReturnType(\r\n            class_name: Form::class,\r\n            method_name: 'blanks',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false,\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 3\r\n     */\r\n    #[TestDox('specify an int type for Form::letters word parameter')]\r\n    public function testParameterTypeOfFormLettersWordParameter()\r\n    {\r\n        $this->assertMethodParameter(\r\n            class_name: Form::class,\r\n            method_name: 'letters',\r\n            parameter_name: 'word',\r\n            parameter_index: 0,\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false,\r\n                'has_default_value' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 3\r\n     */\r\n    #[TestDox('specify an int type for Form::letters return type')]\r\n    public function testParameterTypeOfFormLettersReturnType()\r\n    {\r\n        $this->assertMethodReturnType(\r\n            class_name: Form::class,\r\n            method_name: 'letters',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'array',\r\n                'type_allows_null' => false,\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 4\r\n     */\r\n    #[TestDox('specify an int type for Form::checkLength word parameter')]\r\n    public function testParameterTypeOfFormCheckLengthWordParameter()\r\n    {\r\n        $this->assertMethodParameter(\r\n            class_name: Form::class,\r\n            method_name: 'checkLength',\r\n            parameter_name: 'word',\r\n            parameter_index: 0,\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false,\r\n                'has_default_value' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 4\r\n     */\r\n    #[TestDox('specify an int type for Form::checkLength max_length parameter')]\r\n    public function testParameterTypeOfFormCheckLengthMaxLengthParameter()\r\n    {\r\n        $this->assertMethodParameter(\r\n            class_name: Form::class,\r\n            method_name: 'checkLength',\r\n            parameter_name: 'max_length',\r\n            parameter_index: 1,\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'int',\r\n                'type_allows_null' => false,\r\n                'has_default_value' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 4\r\n     */\r\n    #[TestDox('specify an int type for Form::checkLength return type')]\r\n    public function testParameterTypeOfFormCheckLengthReturnType()\r\n    {\r\n        $this->assertMethodReturnType(\r\n            class_name: Form::class,\r\n            method_name: 'checkLength',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'bool',\r\n                'type_allows_null' => false,\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 5\r\n     */\r\n    #[TestDox('specify an Address type for Form::formatAddress address parameter')]\r\n    public function testParameterTypeOfFormFormatAddressParameter()\r\n    {\r\n        $this->assertMethodParameter(\r\n            class_name: Form::class,\r\n            method_name: 'formatAddress',\r\n            parameter_name: 'address',\r\n            parameter_index: 0,\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'Address',\r\n                'type_allows_null' => false,\r\n                'has_default_value' => false\r\n            ]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @task_id 5\r\n     */\r\n    #[TestDox('specify an int type for Form::checkLength return type')]\r\n    public function testParameterTypeOfFormFormatAddressReturnType()\r\n    {\r\n        $this->assertMethodReturnType(\r\n            class_name: Form::class,\r\n            method_name: 'formatAddress',\r\n            assertions: [\r\n                'has_type' => true,\r\n                'type_name' => 'string',\r\n                'type_allows_null' => false,\r\n            ]\r\n        );\r\n    }\r\n}\r\n"
  }
}
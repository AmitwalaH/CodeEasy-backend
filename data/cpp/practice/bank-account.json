{
  "language": "cpp",
  "slug": "bank-account",
  "docs": {
    "introduction": "# Introduction\r\n\r\nAfter years of filling out forms and waiting, you've finally acquired your banking license.\r\nThis means you are now officially eligible to open your own bank, hurray!\r\n\r\nYour first priority is to get the IT systems up and running.\r\nAfter a day of hard work, you can already open and close accounts, as well as handle withdrawals and deposits.\r\n\r\nSince you couldn't be bothered writing tests, you invite some friends to help test the system.\r\nHowever, after just five minutes, one of your friends claims they've lost money!\r\nWhile you're confident your code is bug-free, you start looking through the logs to investigate.\r\n\r\nAh yes, just as you suspected, your friend is at fault!\r\nThey shared their test credentials with another friend, and together they conspired to make deposits and withdrawals from the same account _in parallel_.\r\nWho would do such a thing?\r\n\r\nWhile you argue that it's physically _impossible_ for someone to access their account in parallel, your friend smugly notifies you that the banking rules _require_ you to support this.\r\nThus, no parallel banking support, no go-live signal.\r\nSighing, you create a mental note to work on this tomorrow.\r\nThis will set your launch date back at _least_ one more day, but well...\r\n",
    "instructions": "# Instructions\r\n\r\nYour task is to implement bank accounts supporting opening/closing, withdrawals, and deposits of money.\r\n\r\nAs bank accounts can be accessed in many different ways (internet, mobile phones, automatic charges), your bank software must allow accounts to be safely accessed from multiple threads/processes (terminology depends on your programming language) in parallel.\r\nFor example, there may be many deposits and withdrawals occurring in parallel; you need to ensure there are no [race conditions][wikipedia] between when you read the account balance and set the new balance.\r\n\r\nIt should be possible to close an account; operations against a closed account must fail.\r\n\r\n[wikipedia]: https://en.wikipedia.org/wiki/Race_condition#In_software\r\n",
    "hints": ""
  },
  "starter_code": {
    "bank_account.cpp": "#include \"bank_account.h\"\r\n\r\nnamespace Bankaccount {}\r\n",
    "bank_account.h": "#pragma once\r\n\r\nnamespace Bankaccount {\r\nclass Bankaccount {};  // class Bankaccount\r\n\r\n}  // namespace Bankaccount\r\n"
  },
  "tests": {
    "bank_account_test.cpp": "#include \"bank_account.h\"\r\n#ifdef EXERCISM_TEST_SUITE\r\n#include <catch2/catch.hpp>\r\n#else\r\n#include \"test/catch.hpp\"\r\n#endif\r\n#include <chrono>\r\n#include <string>\r\n#include <thread>\r\n\r\nTEST_CASE(\"Newly opened account has zero balance\",\r\n          \"[983a1528-4ceb-45e5-8257-8ce01aceb5ed]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    REQUIRE(account.balance() == 0);\r\n}\r\n\r\n#if defined(EXERCISM_RUN_ALL_TESTS)\r\nTEST_CASE(\"Single deposit\", \"[e88d4ec3-c6bf-4752-8e59-5046c44e3ba7]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.deposit(100);\r\n    REQUIRE(account.balance() == 100);\r\n}\r\n\r\nTEST_CASE(\"Multiple deposits\", \"[3d9147d4-63f4-4844-8d2b-1fee2e9a2a0d]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.deposit(100);\r\n    account.deposit(50);\r\n    REQUIRE(account.balance() == 150);\r\n}\r\n\r\nTEST_CASE(\"Withdraw once\", \"[08f1af07-27ae-4b38-aa19-770bde558064]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.deposit(100);\r\n    account.withdraw(75);\r\n    REQUIRE(account.balance() == 25);\r\n}\r\n\r\nTEST_CASE(\"Withdraw twice\", \"[6f6d242f-8c31-4ac6-8995-a90d42cad59f]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.deposit(100);\r\n    account.withdraw(80);\r\n    account.withdraw(20);\r\n    REQUIRE(account.balance() == 0);\r\n}\r\n\r\nTEST_CASE(\"Can do multiple operations sequentially\",\r\n          \"[45161c94-a094-4c77-9cec-998b70429bda]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.deposit(100);\r\n    account.deposit(110);\r\n    account.withdraw(200);\r\n    account.deposit(60);\r\n    account.withdraw(50);\r\n    REQUIRE(account.balance() == 20);\r\n}\r\n\r\nTEST_CASE(\"annot check balance of closed account\",\r\n          \"[f9facfaa-d824-486e-8381-48832c4bbffd]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.close();\r\n\r\n    REQUIRE_THROWS_AS(account.balance(), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot deposit into closed account\",\r\n          \"[7a65ba52-e35c-4fd2-8159-bda2bde6e59c]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.close();\r\n\r\n    REQUIRE_THROWS_AS(account.deposit(50), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot deposit into unopened account\",\r\n          \"[a0a1835d-faae-4ad4-a6f3-1fcc2121380b]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    REQUIRE_THROWS_AS(account.deposit(50), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot withdraw from closed account\",\r\n          \"[570dfaa5-0532-4c1f-a7d3-0f65c3265608]\") {\r\n    Bankaccount::Bankaccount account{};\r\n    account.open();\r\n    account.close();\r\n\r\n    REQUIRE_THROWS_AS(account.withdraw(50), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot close an account that was not opened\",\r\n          \"[c396d233-1c49-4272-98dc-7f502dbb9470]\") {\r\n    Bankaccount::Bankaccount account;\r\n\r\n    REQUIRE_THROWS_AS(account.close(), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot open an already opened account\",\r\n          \"[c06f534f-bdc2-4a02-a388-1063400684de]\") {\r\n    Bankaccount::Bankaccount account;\r\n    account.open();\r\n\r\n    REQUIRE_THROWS_AS(account.open(), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Reopened account does not retain balance\",\r\n          \"[0722d404-6116-4f92-ba3b-da7f88f1669c]\") {\r\n    Bankaccount::Bankaccount account;\r\n    account.open();\r\n    account.deposit(50);\r\n    account.close();\r\n    account.open();\r\n\r\n    REQUIRE(account.balance() == 0);\r\n}\r\n\r\nTEST_CASE(\"Cannot withdraw more than deposited\",\r\n          \"[ec42245f-9361-4341-8231-a22e8d19c52f]\") {\r\n    Bankaccount::Bankaccount account;\r\n    account.open();\r\n    account.deposit(25);\r\n\r\n    REQUIRE_THROWS_AS(account.withdraw(50), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot withdraw negative\",\r\n          \"[4f381ef8-10ef-4507-8e1d-0631ecc8ee72]\") {\r\n    Bankaccount::Bankaccount account;\r\n    account.open();\r\n    account.deposit(100);\r\n    REQUIRE_THROWS_AS(account.withdraw(-50), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Cannot deposit negative\", \"[d45df9ea-1db0-47f3-b18c-d365db49d938]\") {\r\n    Bankaccount::Bankaccount account;\r\n    account.open();\r\n\r\n    REQUIRE_THROWS_AS(account.deposit(-50), std::runtime_error);\r\n}\r\n\r\nTEST_CASE(\"Can handle concurrent transactions\",\r\n          \"[ba0c1e0b-0f00-416f-8097-a7dfc97871ff]\") {\r\n    Bankaccount::Bankaccount account;\r\n    account.open();\r\n\r\n    std::vector<std::thread> vec_of_threads;\r\n\r\n    for (int i = 0; i < 1000; ++i) {\r\n        vec_of_threads.push_back(std::thread([&]() {\r\n            using namespace std::chrono_literals;\r\n            account.deposit(1);\r\n            std::this_thread::sleep_for(5ms);\r\n            account.withdraw(1);\r\n        }));\r\n    }\r\n\r\n    for (auto& th : vec_of_threads) {\r\n        th.join();\r\n    }\r\n\r\n    REQUIRE(account.balance() == 0);\r\n}\r\n#endif\r\n"
  }
}
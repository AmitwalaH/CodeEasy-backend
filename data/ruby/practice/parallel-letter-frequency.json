{
  "language": "ruby",
  "type": "practice",
  "slug": "parallel-letter-frequency",
  "title": "Parallel Letter Frequency",
  "docs": {
    "instructions": "# Instructions\r\n\r\nCount the frequency of letters in texts using parallel computation.\r\n\r\nParallelism is about doing things in parallel that can also be done sequentially.\r\nA common example is counting the frequency of letters.\r\nEmploy parallelism to calculate the total frequency of each letter in a list of texts.\r\n",
    "hints": ""
  },
  "starter_code": "=begin\r\nWrite your code for the 'Parallel Letter Frequency' exercise in this file. Make\r\nthe tests in `parallel_letter_frequency_test.rb` pass.\r\n\r\nTo get started with TDD, see the `README.md` file in your\r\n`ruby/parallel_letter_frequency` directory.\r\n=end\r\n",
  "tests": "require 'minitest/autorun'\r\nrequire_relative 'parallel_letter_frequency'\r\n\r\n# rubocop:disable Layout/SpaceInsideHashLiteralBraces\r\nclass ParallelLetterFrequencyTest < Minitest::Test\r\n  def test_no_texts\r\n    # skip\r\n    texts = %w[]\r\n    expected = {}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_one_text_one_letter\r\n    skip\r\n    texts = %w[a]\r\n    expected = {'a' => 1}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_one_text_multiple_letters\r\n    skip\r\n    texts = %w[abbca]\r\n    expected = {'a' => 2, 'b' => 2, 'c' => 1}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_two_texts_one_letter\r\n    skip\r\n    texts = %w[a a]\r\n    expected = {'a' => 2}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_two_texts_multiple_letters\r\n    skip\r\n    texts = %w[abcd ac]\r\n    expected = {'a' => 2, 'b' => 1, 'c' => 2, 'd' => 1}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_ignore_letter_case\r\n    skip\r\n    texts = %w[Aa aA]\r\n    expected = {'a' => 4}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_ignore_whitespace\r\n    skip\r\n    texts = ['  ', \"\\t\", \"\\n\", \"\\r\\n\"]\r\n    expected = {}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_ignore_punctuation\r\n    skip\r\n    texts = ['!', '?', ';', ',', '.', '-', '—', '’', \"'\", '\"', '/', ':', '{}', '[]', '()']\r\n    expected = {}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_ignore_numbers\r\n    skip\r\n    texts = %w[1 2 3 4 5 6 7 8 9 0]\r\n    expected = {}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_unicode_letters\r\n    skip\r\n    texts = %w[本 φ ほ ø]\r\n    expected = {'本' => 1, 'φ' => 1, 'ほ' => 1, 'ø' => 1}\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_combo_lower_upper_punctuation_whitespace\r\n    skip\r\n    ruby_wiki = File.read(File.expand_path('data/ruby_wiki.txt', __dir__))\r\n    texts = [ruby_wiki]\r\n    expected = {\r\n      \"r\" => 34,\r\n      \"u\" => 20,\r\n      \"b\" => 10,\r\n      \"y\" => 14,\r\n      \"i\" => 53,\r\n      \"s\" => 26,\r\n      \"a\" => 46,\r\n      \"n\" => 37,\r\n      \"t\" => 34,\r\n      \"e\" => 39,\r\n      \"p\" => 28,\r\n      \"d\" => 24,\r\n      \"h\" => 10,\r\n      \"g\" => 23,\r\n      \"l\" => 26,\r\n      \"v\" => 6,\r\n      \"o\" => 26,\r\n      \"m\" => 25,\r\n      \"w\" => 5,\r\n      \"c\" => 18,\r\n      \"j\" => 5,\r\n      \"k\" => 2,\r\n      \"z\" => 1,\r\n      \"f\" => 4\r\n    }\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_large_texts\r\n    skip\r\n    ch37 = File.read(File.expand_path('data/moby_dick_ch37.txt', __dir__))\r\n    ch38 = File.read(File.expand_path('data/moby_dick_ch38.txt', __dir__))\r\n    ch39 = File.read(File.expand_path('data/moby_dick_ch39.txt', __dir__))\r\n    texts = [ch37, ch38, ch39]\r\n    expected = {\r\n      \"f\" => 89,\r\n      \"o\" => 333,\r\n      \"r\" => 250,\r\n      \"e\" => 570,\r\n      \"t\" => 429,\r\n      \"p\" => 57,\r\n      \"s\" => 311,\r\n      \"u\" => 131,\r\n      \"b\" => 110,\r\n      \"l\" => 260,\r\n      \"a\" => 356,\r\n      \"n\" => 278,\r\n      \"d\" => 184,\r\n      \"m\" => 156,\r\n      \"i\" => 352,\r\n      \"g\" => 120,\r\n      \"c\" => 77,\r\n      \"h\" => 308,\r\n      \"y\" => 113,\r\n      \"v\" => 52,\r\n      \"k\" => 49,\r\n      \"q\" => 2,\r\n      \"w\" => 133,\r\n      \"x\" => 2,\r\n      \"j\" => 6,\r\n      \"z\" => 4\r\n    }\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_many_small_texts\r\n    skip\r\n    texts = Array.new(100, 'abc')\r\n    actual = ParallelLetterFrequency.count(texts)\r\n    expected = {'a' => 100, 'b' => 100, 'c' => 100}\r\n    assert_equal expected, actual\r\n  end\r\n\r\n  def test_faster_than_serialized_answer\r\n    skip\r\n    texts = Array.new(20, 'a' * 100_000)\r\n\r\n    GC.start\r\n    t0_parallel = Minitest.clock_time\r\n    ParallelLetterFrequency.count(texts)\r\n    parallel_time = Minitest.clock_time - t0_parallel\r\n\r\n    t0_sequential = Minitest.clock_time\r\n    sequential_letter_frequency(texts)\r\n    sequential_time = Minitest.clock_time - t0_sequential\r\n\r\n    assert parallel_time < sequential_time,\r\n      'Parallel execution should be faster than sequential for batches of large texts'\r\n  end\r\n\r\n  def sequential_letter_frequency(texts)\r\n    tally = Hash.new(0)\r\n    texts.each do |text|\r\n      text.each_grapheme_cluster do |cluster|\r\n        tally[cluster] += 1\r\n      end\r\n    end\r\n\r\n    tally\r\n  end\r\nend\r\n# rubocop:enable Layout/SpaceInsideHashLiteralBraces\r\n"
}
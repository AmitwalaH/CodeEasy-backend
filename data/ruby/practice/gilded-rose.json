{
  "language": "ruby",
  "type": "practice",
  "slug": "gilded-rose",
  "title": "Gilded Rose",
  "docs": {
    "instructions": "# Instructions\r\n\r\nWelcome to the engineering team at the Gilded Rose!\r\nAs you know, we're an inn that buys and sells only the finest goods.\r\nOur goods are constantly degrading in quality as they approach their sell-by date, so we have an inventory system that keeps track of these data.\r\n\r\nWe need you to add a new feature to our system so that we can begin selling a new category of items.\r\nHowever, the code is a mess, and it will be difficult to add the new feature unless you first refactor the existing code.\r\n\r\nSo your task is twofold: refactor the inventory system, then add the new feature.\r\n\r\n## Overview of the inventory system\r\n\r\nHere are the basics of our system:\r\n\r\n- All items have a \"sell in\" attribute, which denotes the number of days we have to sell the item.\r\n- All items have a \"quality\" attribute, which denotes how valuable the item is.\r\n- At the end of each day, our system lowers both values for every item.\r\n\r\nPretty simple, right? Well, this is where it gets interesting:\r\n\r\n- Once the sell-by date has arrived, quality degrades twice as fast.\r\n- The quality of an item is never negative.\r\n- **_Aged Brie_** actually *increases* in quality the older it gets.\r\n- The quality of an item is never more than 50.\r\n- **_Sulfuras_**, being a legendary item, does not have a sell-by date, and it has a quality of 80 which never decreases.\r\n- **_Backstage passes_**, like **_Aged Brie_**, increase in quality as their sell-by date approaches: quality increases by 2 when there are 10 days or less and by 3 when there are 5 days or less, but quality drops to 0 after the concert.\r\n\r\n## 1. Refactor\r\n\r\nTo pave the way for the new feature, refactor the existing code and make it easier to change.\r\n\r\nFeel free to make any changes and add any new code as long as everything still works correctly (i.e., as long as the tests for existing features still pass).\r\n\r\nNote: you can assume that items always _start_ with a valid quality.\r\nIn other words, the automated tests don't check what happens when an item has an initial quality above the maximum, or when a **_Sulfuras_** has an initial quality other than 80.\r\n\r\n## 2. Add the new feature\r\n\r\nWe have recently signed a supplier of **_Conjured_** items.\r\nYour job is to add the following rules to our system:\r\n\r\n- **_Conjured_** items drop to 0 quality once their sell-by date has arrived. Additionally:\r\n  - **_Conjured normal items_** degrade in quality twice as fast as non-conjured normal items.\r\n  - **_Conjured Sulfuras_** has a sell-by date, unlike a non-conjured Sulfuras.\r\n  - **_Conjured backstage passes_** increase in quality by 1 less than if they were not conjured.\r\n",
    "hints": "# Hints\r\n\r\n## General\r\n\r\n- If you're not sure how to start the refactor, watch the talk [\"All the Little Things\"][all-the-little-things] by Sandi Metz, and pause it as soon as you find inspiration. Try not to watch the whole talk until after you've solved the exercise! Then you can watch the rest of the talk and improve upon your first iteration.\r\n\r\n[all-the-little-things]: https://www.youtube.com/watch?v=8bZh5LMaSmE\r\n"
  },
  "starter_code": "Item = Struct.new(:name, :sell_in, :quality)\r\n\r\nclass GildedRose\r\n  def initialize(items)\r\n    @items = items\r\n  end\r\n\r\n  def update!\r\n    @items.each do |item|\r\n      if item.name != \"Aged Brie\" && item.name != \"Backstage passes to a TAFKAL80ETC concert\"\r\n        if item.quality > 0\r\n          if item.name != \"Sulfuras, Hand of Ragnaros\"\r\n            item.quality -= 1\r\n          end\r\n        end\r\n      else\r\n        if item.quality < 50\r\n          item.quality += 1\r\n          if item.name == \"Backstage passes to a TAFKAL80ETC concert\"\r\n            if item.sell_in < 11\r\n              if item.quality < 50\r\n                item.quality += 1\r\n              end\r\n            end\r\n            if item.sell_in < 6\r\n              if item.quality < 50\r\n                item.quality += 1\r\n              end\r\n            end\r\n          end\r\n        end\r\n      end\r\n\r\n      if item.name != \"Sulfuras, Hand of Ragnaros\"\r\n        item.sell_in -= 1\r\n      end\r\n\r\n      if item.sell_in < 0\r\n        if item.name != \"Aged Brie\"\r\n          if item.name != \"Backstage passes to a TAFKAL80ETC concert\"\r\n            if item.quality > 0\r\n              if item.name != \"Sulfuras, Hand of Ragnaros\"\r\n                item.quality -= 1\r\n              end\r\n            end\r\n          else\r\n            item.quality = item.quality - item.quality\r\n          end\r\n        else\r\n          if item.quality < 50\r\n            item.quality += 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n  end\r\nend\r\n",
  "tests": "require 'minitest/autorun'\r\nrequire_relative 'gilded_rose'\r\n\r\nclass GildedRoseTest < Minitest::Test\r\n  def update_with(sell_in:, quality:, name:, sell_in_change: -1, quality_change: -1)\r\n    item = Item.new(name:, sell_in:, quality:)\r\n    GildedRose.new([item]).update!\r\n\r\n    assert_equal sell_in + sell_in_change, item.sell_in\r\n    assert_equal quality + quality_change, item.quality\r\n  end\r\n\r\n  def test_normal_item_before_sell_date\r\n    update_with sell_in: 1, quality: 10, name: \"some item\"\r\n  end\r\n\r\n  def test_normal_item_on_sell_date\r\n    update_with sell_in: 0, quality: 10, name: \"some item\", quality_change: -2\r\n  end\r\n\r\n  def test_normal_item_after_sell_date\r\n    update_with sell_in: -1, quality: 10, name: \"some item\", quality_change: -2\r\n  end\r\n\r\n  def test_normal_item_of_zero_quality\r\n    update_with sell_in: 1, quality: 0, name: \"some item\", quality_change: 0\r\n  end\r\n\r\n  def test_normal_item_near_zero_quality\r\n    update_with sell_in: 0, quality: 1, name: \"some item\", quality_change: -1\r\n  end\r\n\r\n  def test_brie_before_sell_date\r\n    update_with sell_in: 1, quality: 0, name: \"Aged Brie\", quality_change: 1\r\n  end\r\n\r\n  def test_brie_on_sell_date\r\n    update_with sell_in: 0, quality: 0, name: \"Aged Brie\", quality_change: 2\r\n  end\r\n\r\n  def test_brie_after_sell_date\r\n    update_with sell_in: -1, quality: 0, name: \"Aged Brie\", quality_change: 2\r\n  end\r\n\r\n  def test_brie_of_max_quality\r\n    update_with sell_in: 1, quality: 50, name: \"Aged Brie\", quality_change: 0\r\n  end\r\n\r\n  def test_brie_near_max_quality\r\n    update_with sell_in: 0, quality: 49, name: \"Aged Brie\", quality_change: 1\r\n  end\r\n\r\n  def test_sulfuras_before_sell_date\r\n    update_with sell_in: 1, quality: 80, name: \"Sulfuras, Hand of Ragnaros\",\r\n      sell_in_change: 0, quality_change: 0\r\n  end\r\n\r\n  def test_sulfuras_on_sell_date\r\n    update_with sell_in: 0, quality: 80, name: \"Sulfuras, Hand of Ragnaros\",\r\n      sell_in_change: 0, quality_change: 0\r\n  end\r\n\r\n  def test_sulfuras_after_sell_date\r\n    update_with sell_in: -1, quality: 80, name: \"Sulfuras, Hand of Ragnaros\",\r\n      sell_in_change: 0, quality_change: 0\r\n  end\r\n\r\n  def test_backstage_pass_far_from_sell_date\r\n    update_with sell_in: 11, quality: 10, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 1\r\n  end\r\n\r\n  def test_backstage_pass_medium_from_sell_date_upper_bound\r\n    update_with sell_in: 10, quality: 0, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 2\r\n  end\r\n\r\n  def test_backstage_pass_medium_from_sell_date_lower_bound\r\n    update_with sell_in: 6, quality: 0, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 2\r\n  end\r\n\r\n  def test_backstage_pass_close_to_sell_date_upper_bound\r\n    update_with sell_in: 5, quality: 0, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 3\r\n  end\r\n\r\n  def test_backstage_pass_close_to_sell_date_lower_bound\r\n    update_with sell_in: 1, quality: 0, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 3\r\n  end\r\n\r\n  def test_backstage_pass_on_sell_date\r\n    update_with sell_in: 0, quality: 10, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_backstage_pass_after_sell_date\r\n    update_with sell_in: -1, quality: 10, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_backstage_pass_of_max_quality\r\n    update_with sell_in: 11, quality: 50, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_backstage_pass_near_max_quality\r\n    update_with sell_in: 1, quality: 49, name: \"Backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 1\r\n  end\r\n\r\n  def test_conjured_normal_item_before_sell_date\r\n    update_with sell_in: 1, quality: 10, name: \"Conjured Rabbit\",\r\n      quality_change: -2\r\n  end\r\n\r\n  def test_conjured_normal_item_on_sell_date\r\n    update_with sell_in: 0, quality: 10, name: \"Conjured Rabbit\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_conjured_normal_item_after_sell_date\r\n    update_with sell_in: -1, quality: 10, name: \"Conjured Rabbit\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_conjured_normal_item_of_zero_quality\r\n    update_with sell_in: 1, quality: 0, name: \"Conjured Rabbit\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_normal_item_near_zero_quality\r\n    update_with sell_in: 1, quality: 1, name: \"Conjured Rabbit\",\r\n      quality_change: -1\r\n  end\r\n\r\n  def test_conjured_brie_before_sell_date\r\n    update_with sell_in: 1, quality: 0, name: \"Conjured Aged Brie\",\r\n      quality_change: 1\r\n  end\r\n\r\n  def test_conjured_brie_on_sell_date\r\n    update_with sell_in: 0, quality: 10, name: \"Conjured Aged Brie\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_conjured_brie_after_sell_date\r\n    update_with sell_in: -1, quality: 10, name: \"Conjured Aged Brie\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_conjured_brie_of_max_quality\r\n    update_with sell_in: 1, quality: 50, name: \"Conjured Aged Brie\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_brie_of_zero_quality\r\n    update_with sell_in: 0, quality: 0, name: \"Conjured Aged Brie\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_brie_near_zero_quality\r\n    update_with sell_in: 0, quality: 1, name: \"Conjured Aged Brie\",\r\n      quality_change: -1\r\n  end\r\n\r\n  def test_conjured_sulfuras_before_sell_date\r\n    update_with sell_in: 1, quality: 80, name: \"Conjured Sulfuras, Hand of Ragnaros\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_sulfuras_on_sell_date\r\n    update_with sell_in: 0, quality: 80, name: \"Conjured Sulfuras, Hand of Ragnaros\",\r\n      quality_change: -80\r\n  end\r\n\r\n  def test_conjured_sulfuras_after_sell_date\r\n    update_with sell_in: -1, quality: 80, name: \"Conjured Sulfuras, Hand of Ragnaros\",\r\n      quality_change: -80\r\n  end\r\n\r\n  def test_conjured_sulfuras_of_zero_quality\r\n    update_with sell_in: 0, quality: 0, name: \"Conjured Sulfuras, Hand of Ragnaros\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_sulfuras_near_zero_quality\r\n    update_with sell_in: 0, quality: 1, name: \"Conjured Sulfuras, Hand of Ragnaros\",\r\n      quality_change: -1\r\n  end\r\n\r\n  def test_conjured_backstage_pass_far_from_sell_date\r\n    update_with sell_in: 11, quality: 10, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_backstage_pass_medium_from_sell_date_upper_bound\r\n    update_with sell_in: 10, quality: 0, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 1\r\n  end\r\n\r\n  def test_conjured_backstage_pass_medium_from_sell_date_lower_bound\r\n    update_with sell_in: 6, quality: 0, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 1\r\n  end\r\n\r\n  def test_conjured_backstage_pass_close_to_sell_date_upper_bound\r\n    update_with sell_in: 5, quality: 0, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 2\r\n  end\r\n\r\n  def test_conjured_backstage_pass_close_to_sell_date_lower_bound\r\n    update_with sell_in: 1, quality: 0, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 2\r\n  end\r\n\r\n  def test_conjured_backstage_pass_on_sell_date\r\n    update_with sell_in: 0, quality: 10, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_conjured_backstage_pass_after_sell_date\r\n    update_with sell_in: -1, quality: 10, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: -10\r\n  end\r\n\r\n  def test_conjured_backstage_pass_of_max_quality\r\n    update_with sell_in: 10, quality: 50, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 0\r\n  end\r\n\r\n  def test_conjured_backstage_pass_near_max_quality\r\n    update_with sell_in: 1, quality: 49, name: \"Conjured backstage passes to a TAFKAL80ETC concert\",\r\n      quality_change: 1\r\n  end\r\n\r\n  def test_multiple_items\r\n    normal_item = Item.new(name: \"some item\", sell_in: 1, quality: 10)\r\n    aged_brie = Item.new(name: \"Aged Brie\", sell_in: -1, quality: 10)\r\n\r\n    GildedRose.new([normal_item, aged_brie]).update!\r\n\r\n    assert_equal 9, normal_item.quality\r\n    assert_equal 0, normal_item.sell_in\r\n    assert_equal 12, aged_brie.quality\r\n    assert_equal(-2, aged_brie.sell_in)\r\n  end\r\nend\r\n"
}